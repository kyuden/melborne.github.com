
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    
      <title>RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ</title>
    
    
    <meta name="author" content="kyoendo" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter-ext/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/themes/twitter-ext/css/style.css?body=1" rel="stylesheet" type="text/css" media="all" />
    <link href="/assets/themes/twitter-ext/css/syntax.css" rel="stylesheet" type="text/css" />
    <link href="/assets/themes/twitter-ext/css/lightbox.css" rel="stylesheet" />
    <link media="only screen and (max-device-width: 480px)" href="/assets/themes/twitter-ext/css/iphone.css" type="text/css" rel="stylesheet" />
    <!--<link media="only screen and (device-width: 768px)" href="/assets/themes/twitter-ext/css/ipad.css" type="text/css" rel="stylesheet" />-->
    <!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />-->
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />-->
<!--<script type="text/x-mathjax-config">-->
  <!--MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });-->
<!--</script>-->
<!--<script type="text/javascript"-->
  <!--src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">-->
<!--</script>-->
  </head>
  <body>
    <div id="fb-root"></div>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="avatar" href="/">
            <img src="http://gravatar.com/avatar/97aa01a6f87da85251be77792dec1d9c?s=80" height="75" width="75" class="avatar" />
          </a>
          <a class="brand" href="/">hp12c</a>
          <div id='rss'>
            <a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon32x32.png" alt="" style="border:0"/></a><a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"></a>
            <!--<a href="/atom.xml" id="rss">-->
              <!--<img src="/assets/images/site/rss.png" alt="rss" title="RSS" height="22" width="22" />-->
            <!--</a>-->
          </div>
          <ul class="nav">
            <li>
            <a class="books" href="/books/">Books</a>
            </li>
            <li>
              <a class="myproducts" href="http://welove.herokuapp.com/?keyword=merborne">Products</a>
            </li>
            
            
            


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
    	
      <li><a href="/tags.html">Tags</a></li>
    	
    
  








            <li class='site'>
              <a href="https://twitter.com/merborne" id="twitter">
                <img src="/assets/images/site/twitter.png" alt="twitter" title="@merborne on Twitter" height="32" width="32" />
              </a>
            </li>
            <li class='site'>
              <a href="https://github.com/melborne" id="github">
                <img src="/assets/images/site/github.png" alt="github" title="@melborne on GitHub" height="24" width="24" />
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header span8">
  <div class="date"><span>03 December 2012</span></div>
  <h1 class='page-title'><a href="/2012/12/03/when-bloggers-become-publishers">RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ</a> <small> ブログが電子書籍に変わる日 </small></h1>
</div>

<div class="row">
  <div class="span9">
    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* hp12c */
      google_ad_slot = "7055414638";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <p>「情報革命」とは何でしょうか。それはネットを介した大量情報の流入による社会生活の変化の連続のことです。情報革命の初期に始まる一つの変化は「見る変化」です。情報を最も効率的に処理できる人間の入力デバイスは「目」であり、そのための環境作りがまず構築されるでしょう。</p>

<p>スマートフォンが携帯電話を駆逐したのは、iPhoneのデザインが素晴らしかったからではありません。人々が大量の情報を処理するためには、非効率な「耳」デバイスを置いて、より効率的な「目」デバイスを活用する必要があったからです。</p>

<p>７インチタブレットの新製品投入が相次いでいます。これは何を意味し、何を駆逐するのでしょうか。そのフォルムを見れば答えは明らかでしょう。それはまさに「書籍」なのです。７インチタブレットは「アトムの読書」を「ビットの読書」にすべて置き換えようとしています。</p>

<p>スマートフォンは、話し言葉を文字化して見るためのデバイスとして登場しました。そして７インチタブレットは、文章を読むのに最適化されたデバイスとして今ここに登場したのです。</p>

<p>「見る変化」第二幕の始まりです...</p>

<hr />

<p>スマホもタブレットも持ってない僕が、偉そうに言うことじゃありませんでしたね！（えっ？）</p>

<h2>ブログを電子書籍化する</h2>

<p>さて、そうなると僕はこのブログの行く末が心配です。ブログというメディアはもっぱら大型モニタ用に作られたメディアですから、７インチタブレットにおける快適な読書体験に適しているかというと疑問が残ります。苦労して書いた記事を誰も読まない日が来るとしたら悲しいです。承認欲求が満たされません。ブコメやツイートでの「面白い」「へぇ〜」とかの言葉を食べて今日まで生きてきたのに。</p>

<br/>


<p>そんなわけで...</p>

<br/>


<p>Jekyllを使ったこのブログ記事を電子書籍化するツール「<code>Maliq</code>」をRubyで作りました！</p>

<blockquote><p>rubygems: <a href="https://rubygems.org/gems/maliq" title="maliq | RubyGems.org | your community gem host">Maliq</a>    　　github: <a href="https://github.com/melborne/maliq" title="melborne/maliq">melborne/maliq</a></p></blockquote>

<p>つまり<code>Maliq</code>は、Liquid拡張されたMarkdown形式のコンテンツからEPUBパッケージを作るツールです。Liquidにより実現されているコードのsyntax highlightingやAmazonリンク付きのコンテンツを、そのまま電子書籍化できます。「Markdown」と「Liquid」の頭を取って「Maliq」です。Mr. マリック（Maric）とは何の関係もありません。</p>

<p>Maliqは、<code>maliq</code>と<code>maliq_gepub</code>という２つのコマンドを持っていて、これらのコマンドで簡単にEPUBパッケージが作れるようになっています。maliq はMarkdownをXHTMLに変換し、maliq_gepubはXHTMLファイルからEPUBパッケージを生成します。</p>

<p>maliq_gepubは、小嶋智さんによる「<a href="https://github.com/skoji/gepub" title="skoji/gepub">Gepub</a>」というEPUB3に対応した、Ruby製EPUBジェネレータの単なるラッパーです。Maliqにおける変換の仕事の大半はこのGepubで実現されています。素晴らしい！</p>

<h2>Maliqの使い方</h2>

<p>以下ではMaliqの使い方を説明しています。MaliqはGem化されているので、<code>gem install maliq</code>で入手できます。gepubも同時にインストールされます。</p>

<h3>コマンドの使い方</h3>

<p>以下の手順に従います。</p>

<pre><code>1. Markdownで書かれたコンテンツファイルを準備する（ex. chapter01.md）。

2. EPUB生成に必要とされるメタ情報をYAMLフォーマットでファイル（複数ある場合は最初のファイル）先頭に記述する（Yaml Front Matter）。

3. ファイル内にチャプター区切りを示す特別のマーカーを書くことで、１つのMarkdownファイルを分割して複数のXHTMLファイルを生成できる。デフォルトでのマーカーの書式は`&lt;&lt;&lt;--- &lt;filename&gt; ---&gt;&gt;&gt;`（ex. `&lt;&lt;&lt;--- chapter02 ---&gt;&gt;&gt;`）。

4. CSSおよび画像ファイルがあるなら、カレントディレクトリまたはそのサブディレクトリに配置する。

5. コンテンツに特別なLiquid Tagが含まれている場合、対応Pluginを`plugins`サブディレクトリに置く。

6. `maliq`コマンドにMarkdownファイル名を渡して実行する(maliq chapter01.md)。これにより、１または複数のXHTMLファイルがカレントディレクトリに生成される。

7. `maliq_gepub`を実行する。これにより、EPUBファイルがカレントディレクトリ生成される。
</code></pre>

<h3>Yaml Front Matterのサンプル</h3>

<p>YFMのサンプルを示します。</p>

<div class="highlight"><pre><code class="text">---
language: &#39;en&#39;
unique_identifier:
 - &#39;http:/example.jp/bookid_in_url&#39;
 - &#39;BookID&#39;
 - &#39;URL&#39;
title: &#39;Book of Charlie&#39;
subtitle: &#39;Where Charlie goes to&#39;
creator: &#39;melborne&#39;
date: &#39;2012-01-01&#39;
---
</code></pre></div>


<p>トリプルダッシュの行の間に、EPUB生成で必要とされるメタ情報をYAMLフォーマットで記述します。メタ項目については以下が参考になります。</p>

<p><a href="http://www.hxa.name/articles/content/epub-guide_hxa7241_2007.html" title="Epub Format Construction Guide - HXA7241 - 2007">Epub Format Construction Guide - HXA7241 - 2007</a></p>

<h3>Liquid plugins</h3>

<p>ネット上には各種Liquid pluginがありますが、Maliqでそれらを利用するためには少し修正が要ります。例えば、ネット上のデータにアクセスする必要のあるpluginではそれをローカル保存するような修正が必要になるでしょう。gistにJekyll向けliquid pluginを修正した僕のpluginが少し置いてあるので利用して下さい。</p>

<blockquote><p><a href="https://gist.github.com/4134497" title="Liquid filters for Maliq gem to generate xhtml — Gist">Liquid filters for Maliq gem to generate xhtml — Gist</a></p></blockquote>

<h3>コードでの使い方</h3>

<p>上記コマンドでは定型的なことしかできません。より柔軟に変換を行いたい場合にはRubyでコードを書く必要があります。</p>

<p><code>Maliq::Converter.new</code>にMarkdownテキストを渡して<code>#run</code>メソッドを実行します。</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">puts</span> <span class="ss">Maliq</span><span class="p">:</span><span class="ss">:Converter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;#header1</span><span class="se">\n</span><span class="s2">line1</span><span class="se">\n\n</span><span class="s2">line2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span>
</code></pre></div>


<p>これにより以下が得られます。</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xmlns:epub=</span><span class="s">&quot;http://www.idpf.org/2007/ops&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
    
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>header1<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;p&gt;</span>line1<span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;p&gt;</span>line2<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>pluginでliquid tagをパースするためには、pluginのフォルダを指定する必要があります。これはYaml Front Matterまたは<code>#set_meta</code>メソッドで行います。フォルダのデフォルトは<code>plugins</code>になっているので、その場合は指定は不要です。</p>

<div class="highlight"><pre><code class="ruby"><span class="ss">Maliq</span><span class="p">:</span><span class="ss">:Converter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">&lt;&lt;-</span><span class="no">EOS</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
<span class="sh">---</span>
<span class="sh">liquid: &#39;filters&#39;</span>
<span class="sh">---</span>
<span class="sh"># header1</span>
<span class="sh">{% calc 2 + 3 %}</span>
<span class="no">EOS</span>
</code></pre></div>


<p>これにより<code>filters</code>というフォルダ名にあるcalc pluginが使えるようになります。出力です。</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;h1&gt;</span>header1<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>2 + 3 = 5<span class="nt">&lt;/p&gt;</span>
</code></pre></div>


<p><code>#run</code>にfalseを渡すとbody要素のみを返します。</p>

<h2>簡単なチュートリアル</h2>

<p>次に、順を追って電子書籍を実際に作ってみます。</p>

<h3>コンテンツを準備する</h3>

<p>まずはMarkdownによるコンテンツを用意します。作業ディレクトリを<code>my_first_ebook</code>、ファイル名を<code>chapter01.md</code>とします。</p>

<p>このコンテンツにおけるポイントは次の３点です。</p>

<pre><code>1. コンテンツは"Syntax Highlighting", "Gist", "Amazon Link"用のLiquid Tagを含んでいる。
2. ファイル先頭のYaml Front Matterにおいてメタ情報を定義している。
3. 各章の前にチャプター区切りマーカーを配置している。
</code></pre>

<p>Syntax Highlightingには<a href="http://pygments.org/" title="Pygments — Python syntax highlighter">Pygments</a>とそのRubyラッパー<code>pygments.rb</code>を使うので、事前にそのインストールが必要になります。以下を参考にしてください。</p>

<p><a href="https://github.com/mojombo/jekyll/wiki/Install" title="Install · mojombo/jekyll Wiki">Install · mojombo/jekyll Wiki</a></p>

<p>pygments.rbは<code>gem install pygments.rb</code>です。</p>

<p>またAmazon Linkを使うには、AWSのアカウントとruby-aawsのインストールが必要になります。以下を参考にしてください。</p>

<p><a href="http://zanshin.net/2011/08/24/amazon-plugin-for-octopress/" title="Amazon Plugin for Octopress - Zanshin.net">Amazon Plugin for Octopress - Zanshin.net</a></p>

<p>YFMにおいて<code>unique_identifier</code>、<code>title</code>属性は必須です。<code>language</code>属性も本来必須の属性ですが、Maliqではデフォルトを'ja'としているので、その場合は省略できます。</p>

<p>チュートリアル用に小説を用意しました。上記ポイントに注意しながら目を通してください。中身は気にせずに...</p>

<h4>chapter01.md</h4>

<div class="highlight"><pre><code class="text">---
unique_identifier:
 - &#39;http:/example.jp/bookid_in_url&#39;
 - &#39;BookID&#39;
 - &#39;URL&#39;
title: &#39;Rubyと鶏卵&#39;
subtitle: &#39;Egg in the Ruby&#39;
creator: &#39;melborne&#39;
date: &#39;2012-12-01&#39;
---

# １章　私を煮るなら殻にして

今にして思えばあの時にちゃんとRubyの中に鶏卵を納めておくべきだった。そうすれば、彼女がこんなに変わってしまうことはなかった。そのときの光景はおぞましくも僕の脳裏に焼き付いて離れないけど、それをコードで表現するなら差し詰め次のようになるだろう。

{% highlight ruby %}
if egg.nil?
  egg = Egg.new
elsif egg.empty?
  egg &lt;&lt; Egg.new
end
{% endhighlight %}

僕はここで重大なミスを犯す。彼女は`egg`がnilのときにカラにして欲しいと望んだのに、どういう訳か僕は誤って`Egg.new`してしまった。

それからだった。彼女のすべてが変わってしまったのは。

&lt;&lt;&lt;--- chapter02 ---&gt;&gt;&gt;


# ２章　怠惰な日々とはにわとGeorge

ルート101を北に向かってもう３時間も休みなしに走ってる。隣には「デカバチンはにわ」が100個ほど置いてある。全くやってられない。彼女は「デカバチンはにわ100個をGeorgeに必ず渡して」って言ったけど、僕はGeorgeがどこで何を生業として生きている人間であるかの情報を、これっぽっちも持ち合わせていない。あるのは彼がRubyと鶏卵に深い造詣があるという彼女からの情報だけだ。それとてフタシカなものだけれども。僕の今の陰鬱な気分をせめてコードで表現させてほしい。

{% gist 4174909 ruby_egg.rb %}

あぁ、どうやら頭が混乱しているようだ。これは昨日Stefanieが僕にpushしたコード片じゃないか。全く、どうかしているよ。

&lt;&lt;&lt;--- chapter03 ---&gt;&gt;&gt;

# ３章　僕とタップを踊ろうよ、どんな意味においても

要約するならば、まあ僕がどうしようもなく世間知らずな若造だった、ってことだ。「デカバチンはにわ」を待ってるGeorgeなんて男は元々この世には存在しなかったし、`egg`がemptyのときは`Egg.new`をappendするってのも悪い方策とも言えない。問題の根本解決にはならないかもしれないけれども。それでも僕はルート101とはにわ100個の不整合性には、もっと早くに気づくべきだった。この一件に関しては完全に僕の負けを認めざるを得ない。ゴメンよRuby。許してくれるなら、僕とタップを踊ろうよ。どんな意味においても。

完

{{ 4806906557 | amazon_medium_image }}
{{ 4806906557 | amazon_link }}
</code></pre></div>


<p>小説中のgist tagはgistサーバー上のコードを指し示しています。内容は次のとおりです。</p>

<p><a href="https://gist.github.com/4174909#file_ruby_egg.rb" title="melborne's gist: 4174909 — Gist">melborne's gist: 4174909 — Gist</a></p>

<h4>ruby_egg.rb</h4>

<div class="highlight"><pre><code class="ruby"><span class="c1"># encoding: UTF-8</span>

<span class="err">∞</span><span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="err">∞</span><span class="p">)</span><span class="o">.</span><span class="n">lazy</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="no">Statue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}</span>
           <span class="o">.</span><span class="n">select</span> <span class="p">{</span><span class="o">|</span><span class="n">statue</span><span class="o">|</span> <span class="n">statue</span><span class="o">.</span><span class="n">of_liberty?</span> <span class="p">}</span>
           <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:george</span><span class="p">)</span>

<span class="c1"># ~&gt; YouLazzyError: undefined method ‘lazy’ for 1..Infinity:Range</span>
</code></pre></div>


<h3>Liquid Pluginの配置</h3>

<p>次に、<code>plugins</code>サブディレクトリを作って、ここにpluginを配置します。ここでは僕のgist上のものをcloneします。</p>

<p><a href="https://gist.github.com/4134497" title="Liquid filters for maliq gem to generate xhtml — Gist">Liquid filters for maliq gem to generate xhtml — Gist</a></p>

<div class="highlight"><pre><code class="bash">my_first_ebook% mkdir plugins
my_first_ebook% git clone git://gist.github.com/4134497.git plugins     
</code></pre></div>


<p>結果、ファイル構成は次のようになります。</p>

<div class="highlight"><pre><code class="bash">my_first_ebook% tree
.
├── chapter01.md
└── plugins
    ├── amazon_liquid_tags.rb
    ├── gist_tag.rb
    ├── highlight.rb
    └── syntax.css

1 directory, 5 files
</code></pre></div>


<h3>CSSおよび画像ファイルの配置</h3>

<p>CSSや画像がある場合は、それぞれcss, imagesなどのサブディレクトリを作って配置します。ここでは<code>css</code>ディレクトリを作って、簡単なスタイルシート<code>style.css</code>とsyntax highliting用の<code>syntax.css</code>を配置します。syntax.cssは先程gistからcloneした中に含まれるものを使います。style.cssは以下のとおりです。</p>

<div class="highlight"><pre><code class="css"><span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="m">#8B1A1A</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">ol</span> <span class="p">{</span>
  <span class="k">list-style-type</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


<p>ここでは実践しませんが、表紙画像がある場合はファイル名に<code>cover</code>を使って(ex. cover.jpg)、imagesディレクトリに配置します。</p>

<h3>XHTMLファイルの生成</h3>

<p>さて下準備ができたので、<code>maliq</code>コマンドを使ってEPUB用XHTMLファイルを生成します。</p>

<div class="highlight"><pre><code class="bash">my_first_ebook% maliq chapter01.md 
/Users/keyes/.rbenv/versions/1.9.3-p327/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in <span class="sb">`</span>require<span class="s1">&#39;: iconv will be deprecated in the future, use String#encode instead.</span>
<span class="s1">&#39;</span>chapter01.xhtml<span class="s1">&#39; created.</span>
<span class="s1">&#39;</span>chapter02.xhtml<span class="s1">&#39; created.</span>
<span class="s1">Image downloading...</span>
<span class="s1">&#39;</span>chapter03.xhtml<span class="err">&#39;</span> created.
</code></pre></div>


<p>警告が出ますが、気にせずに生成されたファイル群を見てみます。</p>

<div class="highlight"><pre><code class="bash">my_first_ebook% tree
.
├── chapter01.md
├── chapter01.xhtml
├── chapter02.xhtml
├── chapter03.xhtml
├── css
│   ├── style.css
│   └── syntax.css
├── images
│   └── 51C9X825VXL._SL160_.jpg
└── plugins
    ├── amazon_liquid_tags.rb
    ├── gist_tag.rb
    └── highlight.rb

2 directories, 8 files
</code></pre></div>


<p>chapter01〜03のXHTMLファイルが生成され、Amazonリンクに係る画像データがDLされているのが分かります。</p>

<p>chapter01.xhtmlの中身をちょっと覗いてみます。</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xmlns:epub=</span><span class="s">&quot;http://www.idpf.org/2007/ops&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Rubyと鶏卵<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&#39;css/style.css&#39;</span> <span class="na">rel=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">type=</span><span class="s">&#39;text/css&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&#39;css/syntax.css&#39;</span> <span class="na">rel=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">type=</span><span class="s">&#39;text/css&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>１章　私を煮るなら殻にして<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>今にして思えばあの時にちゃんとRubyの中に鶏卵を納めておくべきだった。そうすれば、彼女がこんなに変わってしまうことはなかった。そのときの光景はおぞましくも僕の脳裏に焼き付いて離れないけど、それをコードで表現するなら差し詰め次のようになるだろう。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;highlight&quot;</span><span class="nt">&gt;&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;ruby&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;k&quot;</span><span class="nt">&gt;</span>if<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>egg<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>nil?<span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>egg<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>=<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;no&quot;</span><span class="nt">&gt;</span>Egg<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>new<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;k&quot;</span><span class="nt">&gt;</span>elsif<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>egg<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>empty?<span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>egg<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;lt;&amp;lt;</span><span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;no&quot;</span><span class="nt">&gt;</span>Egg<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>new<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;k&quot;</span><span class="nt">&gt;</span>end<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</span>


<span class="nt">&lt;p&gt;</span>僕はここで重大なミスを犯す。彼女は<span class="nt">&lt;code&gt;</span>egg<span class="nt">&lt;/code&gt;</span>がnilのときにカラにして欲しいって望んだのに、どういう訳か僕は誤って<span class="nt">&lt;code&gt;</span>Egg.new<span class="nt">&lt;/code&gt;</span>してしまった。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>それからだった。彼女のすべてが変わってしまったのは。<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>うまく行ったようです。</p>

<h3>EPUBパッケージの生成</h3>

<p>さて、最後に<code>maliq_gepub</code>コマンドを使って、EPUBファイルを生成します。</p>

<div class="highlight"><pre><code class="bash">my_first_ebook% maliq_gepub -o ruby_egg.epub
my_first_ebook% ls -l
total 56
-rw-r--r--  1 keyes  staff   2733 11 30 19:07 chapter01.md
-rw-r--r--  1 keyes  staff   1541 11 30 21:21 chapter01.xhtml
-rw-r--r--  1 keyes  staff   1190 11 30 21:21 chapter02.xhtml
-rw-r--r--  1 keyes  staff   2065 11 30 21:21 chapter03.xhtml
drwxr-xr-x  3 keyes  staff    102 11 30 21:21 images
drwxr-xr-x  6 keyes  staff    204 11 30 19:27 plugins
-rw-r--r--  1 keyes  staff  11716 11 30 21:43 ruby_egg.epub
</code></pre></div>


<p>生成された<code>ruby_egg.epub</code>の中身を見てみます。</p>

<div class="highlight"><pre><code class="bash">my_first_ebook% unzip -v ruby_egg.epub 
Archive:  ruby_egg.epub
 Length   Method    Size  Ratio   Date   Time   CRC-32    Name
 --------  ------  ------- -----   ----   ----   ------    ----
      20  Stored       20   0%  11-30-12 21:43  2cab616f  mimetype
     252  Defl:N      172  32%  11-30-12 21:43  e0f26a53  META-INF/container.xml
    1541  Defl:N      740  52%  11-30-12 21:43  a0b369fe  OEBPS/chapter01.xhtml
    1190  Defl:N      748  37%  11-30-12 21:43  6b7298be  OEBPS/chapter02.xhtml
    2065  Defl:N     1062  49%  11-30-12 21:43  7dd26128  OEBPS/chapter03.xhtml
    6034  Defl:N     6003   1%  11-30-12 21:43  988e6d97  OEBPS/images/51C9X825VXL._SL160_.jpg
     710  Defl:N      377  47%  11-30-12 21:43  0b041246  OEBPS/nav.html
     542  Defl:N      370  32%  11-30-12 21:43  05e77aca  OEBPS/nav.xhtml
    1504  Defl:N      552  63%  11-30-12 21:43  30d6f9d0  OEBPS/package.opf
    1227  Defl:N      514  58%  11-30-12 21:43  0a6ee4da  OEBPS/toc.ncx
--------          -------  ---                            -------
   15085            10558  30%                            10 files
</code></pre></div>


<p>よさそうです。</p>

<p>では、EPUBリーダーでファイルを開いてみます。</p>

<p><img src="/assets/images/2012/ruby_egg01.png" alt="Alt title" /></p>

<p><img src="/assets/images/2012/ruby_egg02.png" alt="Alt title" /></p>

<p><img src="/assets/images/2012/ruby_egg03.png" alt="Alt title" /></p>

<p><img src="/assets/images/2012/ruby_egg04.png" alt="Alt title" /></p>

<p>いいですね！</p>

<p>EPUB電子書籍の完成です。</p>

<br/>


<h2>電子書籍「これからRubyを始める人たちへ」の販売について</h2>

<p>このEPUB生成ツールを使って、早々このブログにおけるRubyの入門記事を１つ電子書籍化しました。</p>

<p>そしてこれに表紙を付けて、「<a href="https://gumroad.com/" title="Gumroad">Gumroad</a>」を通して販売させて戴くことにしました。</p>

<p><img src="/assets/images/2012/start_ruby.jpg" alt="start Ruby" /></p>

<p><img src="/assets/images/2012/start_ruby2.png" alt="start Ruby" />
<img src="/assets/images/2012/start_ruby3.png" alt="start Ruby" /></p>

<p>価格は100円です。</p>

<p>コンテンツについては、ブログ記事「<a href="http://melborne.github.com/2012/04/09/to-newbie/" title="これからRubyを始める人たちへ">これからRubyを始める人たちへ</a>」における、誤記の修正およびメディア向けの調整を行っていますが、実質的な内容についての追加・変更はありません。したがってテキストに関し、有料購入する価値は無いと思います。しかしながら、次の何れかの理由で興味を持たれる方が居られるかもしれません。</p>

<blockquote><ol>
<li><p>コンテンツに関心があるので、それが電子書籍の形態で読めるのはやはり便利だ。</p></li>
<li><p>コードのSyntax HighlightingをEPUBで実現したものをあまり見たことがない。どんなものかちょっと見てみたい。</p></li>
<li><p>このEPUB生成ツール<code>Maliq</code>に関心がある。つまり自分もブログを電子書籍化したいので、その出力サンプルとして参考にしたい。</p></li>
<li><p>ブログの記事を読んだが参考になった。これが無料なんて申し訳なく思うから買ってあげたい。</p></li>
<li><p>ブログの記事は読んでないが、興味はあるのでどうせなら電子書籍で読んでみよう。</p></li>
<li><p>なんか表紙が気に入ったからそれを眺めるために買ってみよう。</p></li>
<li><p>このブログのネタは全体としてなかなか面白い。これからも継続して欲しいので寄付の気持ちで購入してもいいかな。</p></li>
<li><p>タブレットを買ったばかりなので、いろいろな電子書籍を衝動買いしたい。</p></li>
<li><p>今日はいい気分だ。だれでもいいから俺の100円受け取って。</p></li>
</ol>
</blockquote>

<p>次のリンクはGumroadにおける商品購入リンクになっています。クリックすると、オーバーレイ・ウインドウが立ち上がって、この場でクレジットカード決済による購入が可能です。購入にはクレジット情報およびメールアドレスの入力が必要になります。購入すると、入力したメールアドレスにコンテンツのDLリンクが送られてきます。</p>

<p><a href="http://gum.co/RjRO" class="gumroad-button">電子書籍「これからRubyを始める人たちへ」EPUB版</a><script type="text/javascript" src="https://gumroad.com/js/gumroad-button.js"></script><script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script></p>

<p>ご検討のほど、よろしくお願いしますm(__)m</p>

<p>なお、EPUBは<a href="http://www.amazon.co.jp/gp/product/B007OZO03M/ref=bb1_ads_cel_1121?ie=UTF8&amp;nav_sdd=aps&amp;pf_rd_m=AN1VRQENFRJN5&amp;pf_rd_s=center-1&amp;pf_rd_r=1Z9P3B1C879AW391AVRT&amp;pf_rd_t=101&amp;pf_rd_p=122583989&amp;pf_rd_i=489986" title="Kindle Paperwhite - ライト内蔵の電子書籍リーダー">Amazon Kindle</a>では読めないので、mobiなどへの変換が必要です。変換には「<a href="http://calibre-ebook.com/" title="calibre - E-book management">calibre</a>」が便利です。</p>

<hr />

<p>以上、EPUB生成ツール<code>Maliq</code>の紹介と 電子書籍「これからRubyを始める人たちへ」の宣伝でした。</p>

<hr />

<p>関連記事：<a href="http://melborne.github.com/2012/11/12/epub-tutorial/" title="エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩">エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩</a></p>

<hr />

<p>(追記：2012−12−04) pygments.rbのインストールについて追記しました。</p>

<hr />

<p><a href="http://www.amazon.co.jp/Amazon-co-jp-53-000189-Kindle-Paperwhite-3G/dp/B007OZNYMU?SubscriptionId=06WK2XPKDH9TJJ979P02&tag=keyesblog05-22&linkCode=xm2&camp=2025&creative=165953&creativeASIN=B007OZNYMU"><img class="amazon" src="http://ecx.images-amazon.com/images/I/4194BeD1XvL._SL160_.jpg" /></a>
<a href="http://www.amazon.co.jp/Amazon-co-jp-53-000189-Kindle-Paperwhite-3G/dp/B007OZNYMU?SubscriptionId=06WK2XPKDH9TJJ979P02&tag=keyesblog05-22&linkCode=xm2&camp=2025&creative=165953&creativeASIN=B007OZNYMU">Kindle Paperwhite 3G</a></p>


    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* foot */
      google_ad_slot = "7511276945";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <hr>
    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" class="hatena-bookmark-button" data-hatena-bookmark-title="RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" data-text="RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2012/11/12/epub-tutorial" title="エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩">&larr; Previous</a></li>
      
        <li><a href="/">Archive</a></li>
        <!--<li><a href="/archive.html">Archive</a></li>-->
      
        <li class="next"><a href="/2012/12/04/my-first-ebook-released" title="電子書籍「これからRubyを始める人たちへ」EPUB版をGumroadから出版しました！">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'melborne'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span3">
    <div id="bookAd">
      <a href="/books/">
        <!--<img src="/assets/images/2012/start_ruby.jpg" alt="start_ruby" />-->
        <!--<img src="/assets/images/2012/jekyll_cover.jpg" alt="jekyll" />-->
        <!--<img src="/assets/images/2012/ruby_parallel_cover.png" alt="ruby_parallel" />-->
        <!--<img src="/assets/images/2012/js_oop_cover.png" alt="js_oop" />-->
        <!--<img src="/assets/images/2012/rack_cover.png" alt="rack" />-->
        <!--<img src="/assets/images/2013/02/ruby_object_cover.png" alt="ruby_object" />-->
        <img src="/assets/images/2013/03/ruby_trivia_cover.png" alt="ruby_trivia" />
      </a>
      <p id="comment">100円で好評発売中！<br/><a href="/books/">M'ELBORNE BOOKS</a></p>
    </div>

    <hr />
    
      <ul class="tag_box inline">
      
      


  
     
    	<li><a href="/tags.html#ebook-ref">ebook <span>7</span></a></li>
     
    	<li><a href="/tags.html#epub-ref">epub <span>7</span></a></li>
    
  



      </ul>
      <hr />
    

    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" class="hatena-bookmark-button" data-hatena-bookmark-title="RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" data-text="RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2012/12/03/when-bloggers-become-publishers/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>

    <div class="ad" id="sideAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* sidebar */
      google_ad_slot = "0672114662";
      google_ad_width = 160;
      google_ad_height = 600;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>
  </div>
</div>


      </div>

      <footer>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-nc/2.1/jp/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/2.1/jp/88x31.png" /></a>  kyoendo 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>        </p>
      </footer>

    </div> <!-- /container -->

    

    <script type="text/javascript">
      if (location.hostname != 'localhost') {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-288751-18']);
        _gaq.push(['_trackPageview']);
  
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      };
    </script>

    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <script src="/assets/javascripts/jquery-1.7.2.min.js"></script>
    <script src="/assets/javascripts/lightbox.js"></script>

    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>
  </body>
</html>

