
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    
      <title>Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たちにぼくから一言ガツンと申し上げたい</title>
    
    <meta name="description" content="" />
    <meta name="author" content="kyoendo" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter-ext/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/themes/twitter-ext/css/style.css?body=1" rel="stylesheet" type="text/css" media="all" />
    <link href="/assets/themes/twitter-ext/css/syntax.css" rel="stylesheet" type="text/css" />
    <link href="/assets/themes/twitter-ext/css/lightbox.css" rel="stylesheet" />
    <link media="only screen and (max-device-width: 480px)" href="/assets/themes/twitter-ext/css/iphone.css" type="text/css" rel="stylesheet" />
    <!--<link media="only screen and (device-width: 768px)" href="/assets/themes/twitter-ext/css/ipad.css" type="text/css" rel="stylesheet" />-->
    <!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />-->
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />-->
<!--<script type="text/x-mathjax-config">-->
  <!--MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });-->
<!--</script>-->
<!--<script type="text/javascript"-->
  <!--src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">-->
<!--</script>-->
  </head>
  <body>
    <div id="fb-root"></div>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="avatar" href="/">
            <img src="http://gravatar.com/avatar/97aa01a6f87da85251be77792dec1d9c?s=80" height="75" width="75" class="avatar" />
          </a>
          <a class="brand" href="/">hp12c</a>
          <div id='rss'>
            <a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon32x32.png" alt="" style="border:0"/></a><a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"></a>
            <!--<a href="/atom.xml" id="rss">-->
              <!--<img src="/assets/images/site/rss.png" alt="rss" title="RSS" height="22" width="22" />-->
            <!--</a>-->
          </div>
          <ul class="nav">
            <li>
            <a class="books" href="/books/">Books</a>
            </li>
            <li>
              <a class="myproducts" href="http://welove.herokuapp.com/?keyword=merborne">Products</a>
            </li>
            
            
            


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
    	
      <li><a href="/tags.html">Tags</a></li>
    	
    
  








            <li class='site'>
              <a href="https://twitter.com/merborne" id="twitter">
                <img src="/assets/images/site/twitter.png" alt="twitter" title="@merborne on Twitter" height="32" width="32" />
              </a>
            </li>
            <li class='site'>
              <a href="https://github.com/melborne" id="github">
                <img src="/assets/images/site/github.png" alt="github" title="@melborne on GitHub" height="24" width="24" />
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header span8">
  <div class="date"><span>25 February 2013</span></div>
  <h1 class='page-title'><a href="/2013/02/25/i-wanna-say-something-about-rubys-case">Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たちにぼくから一言ガツンと申し上げたい</a> <small>  </small></h1>
</div>

<div class="row">
  <div class="span9">
    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* hp12c */
      google_ad_slot = "7055414638";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <p>「Rubyのcase」を一瞥し「あー要は〇〇(言語名)のswitchね」などと早合点し、その後もその真の価値を知ることなく一生を終えるプログラマが近年跡を絶たない。加えて、「今更条件分岐？RubyはOOPなんだからポリモフィズムじゃね？」とか「HashにProc突っ込んでcallするのがオレ流。」とかうそぶく人たちもまた増加の一途を辿っている。</p>

<p>そんな世の中にあって、ぼくは一言、できればガツンと一言申し上げたい。生まれも育ちもRubyなぼくから、是非ともそんな人たちに「Rubyのcase」について一言申し上げておきたい。</p>

<br />


<h2>─ 問題１ ─</h2>

<blockquote><p>名前<code>name</code>、レベル<code>level</code>、ポイント<code>point</code>の各属性を持った複数のCharacterオブジェクトcharlie, liz, benがある。</p></blockquote>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Character</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:level</span><span class="p">,</span> <span class="ss">:point</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="s2">&quot;%s:</span><span class="se">\t</span><span class="s2">lv:%d</span><span class="se">\t</span><span class="s2">pt:%d&quot;</span> <span class="o">%</span> <span class="n">values</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">charlie</span> <span class="o">=</span> <span class="no">Character</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">liz</span> <span class="o">=</span> <span class="no">Character</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Liz&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ben</span> <span class="o">=</span> <span class="no">Character</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Ben&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">charas</span> <span class="o">=</span> <span class="o">[</span><span class="n">charlie</span><span class="p">,</span> <span class="n">liz</span><span class="p">,</span> <span class="n">ben</span><span class="o">]</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:0</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:0</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:0</span>
</code></pre></div>


<blockquote><p>キャラクタのレベルに応じてポイントを加算する<code>bonus_point</code>メソッドを実装せよ。但し、キャラクタレベルがlow(1〜3)のときは10ポイント、mid(4〜7)のときは5ポイント、high(8または9)のときは3ポイント、それ以外のときは0ポイントをpointに加算するものとする。</p></blockquote>

<h2>その０</h2>

<p>さて、まずは<code>if-else</code>で実装してみますよ。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">between?</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">10</span>
  <span class="k">elsif</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">between?</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">5</span>
  <span class="k">elsif</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">between?</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>各式のアライメントが取れないから、ちょっと見づらいですねぇ。</p>

<h2>その１</h2>

<p>じゃあ、このままcaseに移管しますか。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="k">case</span>
  <span class="k">when</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">between?</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">10</span>
  <span class="k">when</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">between?</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">5</span>
  <span class="k">when</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">between?</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>アライメントが取れてちょっとマシになりましたか。</p>

<p>こうしてcaseはcase後の式を省略してif-else風にも書けるんですよ。</p>

<h2>その２</h2>

<p>でも、こういうのあんまり見ませんねぇ。普通に行きましょうね。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
  <span class="k">when</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">10</span>
  <span class="k">when</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">5</span>
  <span class="k">when</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>あー良くなりました。whenの後にカンマ区切りで複数の式置けるんですね。</p>

<h2>その３</h2>

<p>でも、まあ普通、こうはしませんよね。こうですね。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
  <span class="k">when</span> <span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">10</span>
  <span class="k">when</span> <span class="mi">4</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">5</span>
  <span class="k">when</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>ええ、Rangeです。でも、どうしてこういうことできるんですか？</p>

<p>それはね、caseの一致判定は<code>===</code>なんですよ。===は、これ、Rubyでは演算子じゃなくてメソッドなんですね。つまりオブジェクト毎に再定義可能なんです。</p>

<p>で、Range#===ってのが見事にRange#include?と同じ働きをするよう再定義されてるんです。マニュアル見てくださいね。だからwhenの後の式は概ねこんな感じですか。</p>

<div class="highlight"><pre><code class="ruby"><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">chara</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
</code></pre></div>


<p>これ聞いちゃうと、どんどん発想広がりますよね？</p>

<h2>その４</h2>

<p>ただね、まだこういう手もあるんですよ。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
  <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
  <span class="k">when</span> <span class="o">*</span><span class="n">low</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">10</span>
  <span class="k">when</span> <span class="o">*</span><span class="n">mid</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">5</span>
  <span class="k">when</span> <span class="o">*</span><span class="n">high</span>
    <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="mi">3</span>
  <span class="k">else</span>
    <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>そう、<code>*</code>を使って配列展開もできるんですよ。low, mid, highというラベル（変数）の導入で抽象度が一段上がった気もしますね。</p>

<h2>その５</h2>

<p>さて、でもまだちょっとゴチャゴチャしてますよね。今度はこうしましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">low</span>
      <span class="mi">10</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">mid</span>
      <span class="mi">5</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">high</span>
      <span class="mi">3</span>
    <span class="k">else</span>
      <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>スッキリしましたねぇ。そう、caseは「文」じゃなくて「式」、つまり評価の結果を返すんです。便利ですよね。</p>

<h2>その６</h2>

<p>でも、今度はちょっとスカスカな感じもしますよ。こうしましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">low</span>  <span class="k">then</span> <span class="mi">10</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">mid</span>  <span class="k">then</span> <span class="mi">5</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">high</span> <span class="k">then</span> <span class="mi">3</span>
    <span class="k">else</span> <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p><code>then</code>を使えば式とその評価を一行にできますね。</p>

<h2>その７</h2>

<p>もちろん、セミコロン<code>;</code>使ってもいいですよ。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">low</span><span class="p">;</span> <span class="mi">10</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">mid</span><span class="p">;</span>  <span class="mi">5</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">high</span><span class="p">;</span> <span class="mi">3</span>
    <span class="k">else</span> <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>


<h2>その８</h2>

<p>代入のところで改行入るの嫌う人もいますよね。わたし気にしませんが。じゃこうしてください。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span> <span class="k">begin</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">low</span><span class="p">;</span> <span class="mi">10</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">mid</span><span class="p">;</span>  <span class="mi">5</span>
    <span class="k">when</span> <span class="o">*</span><span class="n">high</span><span class="p">;</span> <span class="mi">3</span>
    <span class="k">else</span> <span class="mi">0</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>


<p>さて、概ねいいと思うんですけど、もう少し続けてみますよ。</p>

<h2>その９</h2>

<p>lowとかの前に付いてる<code>*</code>ってのが少しcrypticっていう人もいるんじゃないですか。</p>

<p>じゃあ、そういう人はこれなんかはお好みですかね？</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">is_low</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
  <span class="n">is_mid</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="p">(</span><span class="mi">4</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
  <span class="n">is_high</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">].</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="n">is_low</span><span class="p">;</span> <span class="mi">10</span>
    <span class="k">when</span> <span class="n">is_mid</span><span class="p">;</span>  <span class="mi">5</span>
    <span class="k">when</span> <span class="n">is_high</span><span class="p">;</span> <span class="mi">3</span>
    <span class="k">else</span> <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>なんですか、これは。</p>

<p>あー、<code>-&gt;lv{ }</code>ってのはProcオブジェクトですね？で、こんなところにProc置けるんですか。つまりこれは、<code>Proc#===</code>ってのが定義されているって話ですか？マニュアル見てみますか？</p>

<p>ほほぅ。Proc#===は、<code>Proc#call</code>と同じと書いてありますですよ。すると、when節に来ると、is_lowにセットされたProcがchara.levelを引数にとって実行され真偽が判定される、ってことですね。上では、RangeとArray微妙に使い分けたりしてますが。</p>

<p>もうこうなると、一致判定飛び越えてるじゃないですか。なんでもありですよ、Procさん呼べば。ただ、when節ごとにProc#callするからちょっとコスト増えますね。まあ、気にしませんが。</p>

<h2>その１０</h2>

<p>はっきり言って、Range判定で誰ももう文句ないんですが。</p>

<p>でもねぇ、is_lowはないでしょRubyで、is_lowは。これが変数に<code>?</code>使えないRubyの弱点ですねぇ。</p>

<p>ということで...</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="n">low?</span><span class="p">;</span> <span class="mi">10</span>
    <span class="k">when</span> <span class="n">mid?</span><span class="p">;</span>  <span class="mi">5</span>
    <span class="k">when</span> <span class="n">high?</span><span class="p">;</span> <span class="mi">3</span>
    <span class="k">else</span> <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kp">private</span>
<span class="k">def</span> <span class="nf">low?</span>
  <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">mid?</span>
  <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="p">(</span><span class="mi">4</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">high?</span>
  <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">].</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>判定式をメソッド化しました。Procを返す高階関数ですね。bonus_pointメソッドの中、綺麗になりましたね。</p>

<h2>その１１</h2>

<p>最後は、仕上げですね。ＤＲＹ、ＤＲＹ、Don't Repeat Yourself.　繰り返してるのあなたじゃないですか！</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">bonus_point</span><span class="p">(</span><span class="n">chara</span><span class="p">)</span>
  <span class="n">chara</span><span class="o">.</span><span class="n">point</span> <span class="o">+=</span>
    <span class="k">case</span> <span class="n">chara</span><span class="o">.</span><span class="n">level</span>
    <span class="k">when</span> <span class="n">low?</span><span class="p">;</span> <span class="mi">10</span>
    <span class="k">when</span> <span class="n">mid?</span><span class="p">;</span>  <span class="mi">5</span>
    <span class="k">when</span> <span class="n">high?</span><span class="p">;</span> <span class="mi">3</span>
    <span class="k">else</span> <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kp">private</span>
<span class="k">def</span> <span class="nf">level_seed</span><span class="p">(</span><span class="n">range</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="n">lv</span><span class="p">{</span> <span class="n">range</span><span class="o">.</span><span class="n">include?</span> <span class="n">lv</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">low?</span>
  <span class="n">level_seed</span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">mid?</span>
  <span class="n">level_seed</span><span class="p">(</span><span class="mi">4</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">high?</span>
  <span class="n">level_seed</span><span class="p">(</span><span class="mi">8</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">charas</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">chr</span><span class="o">|</span> <span class="n">bonus_point</span> <span class="n">chr</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">charas</span>

<span class="c1"># &gt;&gt; Charlie:    lv:5    pt:5</span>
<span class="c1"># &gt;&gt; Liz:    lv:3    pt:10</span>
<span class="c1"># &gt;&gt; Ben:    lv:8    pt:3</span>
</code></pre></div>


<p>まあ、こんな感じです。</p>

<p>２問目いってみましょうか。</p>

<h2>─ 問題２ ─</h2>

<blockquote><p>仮想WebフレームワークRackのレスポンスは、３要素の配列、すなわちステータスコード(Fixnum), ヘッダ(Hash), レスポンスボディ(#eachに応答する)を要素とする配列で構成される。以下のレスポンスのうち、res1は有効、res2、res3は無効なレスポンスである。</p></blockquote>

<pre><code>res1 = [200, {'Content-Type' =&gt; 'text/html'}, "Welcome to Rack".chars]
res2 = ['404', {'Content-Type' =&gt; 'text/html'}, "Welcome to Rack".chars]
res3 = [500, {'Content-Type' =&gt; 'text/html'}, "Welcome to Rack"]
</code></pre>

<blockquote><p>有効なレスポンスかをチェックする<code>response_lint</code>メソッドを実装せよ。</p></blockquote>

<h2>その１</h2>

<p>えっ？これ、caseの問題ですか？</p>

<p>普通は<code>&amp;&amp;</code>でこうするんじゃないですか。</p>

<div class="highlight"><pre><code class="ruby"><span class="n">res1</span> <span class="o">=</span> <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res2</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;404&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res3</span> <span class="o">=</span> <span class="o">[</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">]</span>


<span class="k">def</span> <span class="nf">response_lint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="n">res</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Fixnum</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">res</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">res</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span>
<span class="k">end</span>

<span class="o">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">response_lint</span> <span class="n">res</span> <span class="p">}</span> <span class="c1"># =&gt; [true, false, false]</span>
</code></pre></div>


<p>まあ、エレガントとは言えないですけどねぇ。</p>

<h2>その２</h2>

<p>えっ？やっぱり、caseでやるんですか？</p>

<p>どうですかね、こうですか？</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">response_lint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="n">pattern</span> <span class="o">=</span> <span class="o">[</span><span class="no">Fixnum</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">].</span><span class="n">to_enum</span>
  <span class="n">res</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
    <span class="k">case</span> <span class="n">r</span>
    <span class="k">when</span> <span class="n">pattern</span><span class="o">.</span><span class="n">next</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="kp">true</span>
<span class="k">end</span>

<span class="o">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">response_lint</span> <span class="n">res</span> <span class="p">}</span> <span class="c1"># =&gt; [true, false, false]</span>
</code></pre></div>


<p>おー、考えましたねー。<code>#each</code>で順番にレスポンスの要素を見ていく。caseで順番にpatternのクラスと一致判定する。一致しないものがあったら、そこでreturnして<code>false</code>を返して終わり。最後まで行けば<code>true</code>。ですね？<code>to_enum</code>が渋いじゃないですかあ。まあ、無理せずに<code>with_index</code>でもいいんですよ。</p>

<p>ところで、クラスとそのオブジェクトの一致判定ってのはなんですかね。答えはどこですか？</p>

<p>そう、<code>Module#===</code>ですね。まあ<code>Class#===</code>って言ったほうがピンと来ますよね。マニュアルに<code>obj.kind_of?(self)</code>がtrueならtrueって書いてあります。<code>is_a?</code>はaliasですね。</p>

<h2>その３</h2>

<p>まあ、頑張ってるんですけど、そんなに綺麗じゃないですよね。</p>

<p>これ、ラップできないですかね？一致判定クラスですよ。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Pattern</span> <span class="o">&lt;</span> <span class="nb">Array</span>
  <span class="k">def</span> <span class="nf">===</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">zip</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">all?</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span> <span class="o">===</span> <span class="n">b</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>


<p>何か良く見えてこないですけど、<code>Pattern#===</code>ってのを定義しているところを見ると、whenの横に置こうって算段ですか？</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Pattern</span> <span class="o">&lt;</span> <span class="nb">Array</span>
  <span class="k">def</span> <span class="nf">===</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">zip</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">all?</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span> <span class="o">===</span> <span class="n">b</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">response_lint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">res</span>
  <span class="k">when</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">Fixnum</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span> <span class="k">then</span> <span class="kp">true</span>
  <span class="k">else</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">response_lint</span> <span class="n">res</span> <span class="p">}</span> <span class="c1"># =&gt; [true, false, false]</span>
</code></pre></div>


<p>おおっ！</p>

<p>めちゃ可読性高いじゃないですかあ。<code>Pattern[Fixnum, Hash, Enumerable]</code>ってのは、<code>Array.[]</code>つまり<code>Pattern.new()</code>ですね？で、when節に入るとこのPattern配列にresがzipされて、一つづつ<code>===</code>判定されると。パターンマッチング、くわっ！</p>

<p>これ、あなた考えたの？すごいじゃない...</p>

<br />


<p>...ですよね...まさかね...</p>

<p>...<a href="https://rubygems.org/gems/ohm">ohm gem</a>から...盗んできたんですか...</p>

<p><code>Array#zip</code> => <code>#all?</code>はオレのものだって？...</p>

<h2>その４</h2>

<p>Patternは汎用クラスだからこれ、ワンクッション入れて抽象化してもいいですよね。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Pattern</span> <span class="o">&lt;</span> <span class="nb">Array</span>
  <span class="k">def</span> <span class="nf">===</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">zip</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">all?</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span> <span class="o">===</span> <span class="n">b</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Response</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">Fixnum</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>

<span class="k">def</span> <span class="nf">response_lint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">res</span>
  <span class="k">when</span> <span class="no">Response</span> <span class="k">then</span> <span class="kp">true</span>
  <span class="k">else</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">response_lint</span> <span class="n">res</span> <span class="p">}</span> <span class="c1"># =&gt; [true, false, false]</span>
</code></pre></div>


<p>Responseはクラスじゃないんですけど、クラスっぽく見えますね。</p>

<h2>その５</h2>

<p>こうなると、さらに欲が出ますよ。ステータスコード、ちゃんと弾くようにしますか。</p>

<p>となると、ここはRackの出番ですね、ほら。</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s2">&quot;rack&quot;</span>

<span class="ss">Rack</span><span class="p">:</span><span class="ss">:Utils</span><span class="o">::</span><span class="no">HTTP_STATUS_CODES</span> <span class="c1"># =&gt; {100=&gt;&quot;Continue&quot;, 101=&gt;&quot;Switching Protocols&quot;, 102=&gt;&quot;Processing&quot;, 200=&gt;&quot;OK&quot;, 201=&gt;&quot;Created&quot;, 202=&gt;&quot;Accepted&quot;, 203=&gt;&quot;Non-Authoritative Information&quot;, 204=&gt;&quot;No Content&quot;, 205=&gt;&quot;Reset Content&quot;, 206=&gt;&quot;Partial Content&quot;, 207=&gt;&quot;Multi-Status&quot;, 208=&gt;&quot;Already Reported&quot;, 226=&gt;&quot;IM Used&quot;, 300=&gt;&quot;Multiple Choices&quot;, 301=&gt;&quot;Moved Permanently&quot;, 302=&gt;&quot;Found&quot;, 303=&gt;&quot;See Other&quot;, 304=&gt;&quot;Not Modified&quot;, 305=&gt;&quot;Use Proxy&quot;, 306=&gt;&quot;Reserved&quot;, 307=&gt;&quot;Temporary Redirect&quot;, 308=&gt;&quot;Permanent Redirect&quot;, 400=&gt;&quot;Bad Request&quot;, 401=&gt;&quot;Unauthorized&quot;, 402=&gt;&quot;Payment Required&quot;, 403=&gt;&quot;Forbidden&quot;, 404=&gt;&quot;Not Found&quot;, 405=&gt;&quot;Method Not Allowed&quot;, 406=&gt;&quot;Not Acceptable&quot;, 407=&gt;&quot;Proxy Authentication Required&quot;, 408=&gt;&quot;Request Timeout&quot;, 409=&gt;&quot;Conflict&quot;, 410=&gt;&quot;Gone&quot;, 411=&gt;&quot;Length Required&quot;, 412=&gt;&quot;Precondition Failed&quot;, 413=&gt;&quot;Request Entity Too Large&quot;, 414=&gt;&quot;Request-URI Too Long&quot;, 415=&gt;&quot;Unsupported Media Type&quot;, 416=&gt;&quot;Requested Range Not Satisfiable&quot;, 417=&gt;&quot;Expectation Failed&quot;, 422=&gt;&quot;Unprocessable Entity&quot;, 423=&gt;&quot;Locked&quot;, 424=&gt;&quot;Failed Dependency&quot;, 425=&gt;&quot;Reserved for WebDAV advanced collections expired proposal&quot;, 426=&gt;&quot;Upgrade Required&quot;, 427=&gt;&quot;Unassigned&quot;, 428=&gt;&quot;Precondition Required&quot;, 429=&gt;&quot;Too Many Requests&quot;, 430=&gt;&quot;Unassigned&quot;, 431=&gt;&quot;Request Header Fields Too Large&quot;, 500=&gt;&quot;Internal Server Error&quot;, 501=&gt;&quot;Not Implemented&quot;, 502=&gt;&quot;Bad Gateway&quot;, 503=&gt;&quot;Service Unavailable&quot;, 504=&gt;&quot;Gateway Timeout&quot;, 505=&gt;&quot;HTTP Version Not Supported&quot;, 506=&gt;&quot;Variant Also Negotiates (Experimental)&quot;, 507=&gt;&quot;Insufficient Storage&quot;, 508=&gt;&quot;Loop Detected&quot;, 509=&gt;&quot;Unassigned&quot;, 510=&gt;&quot;Not Extended&quot;, 511=&gt;&quot;Network Authentication Required&quot;}</span>
</code></pre></div>


<p>これで、<code>===</code>定義すりゃいいですな。ヒヒィ。</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s2">&quot;rack&quot;</span>

<span class="no">HTTP_STATUS</span> <span class="o">=</span> <span class="ss">Rack</span><span class="p">:</span><span class="ss">:Utils</span><span class="o">::</span><span class="no">HTTP_STATUS_CODES</span>

<span class="k">def</span> <span class="nc">HTTP_STATUS</span><span class="o">.</span><span class="nf">===</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
  <span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="n">k</span> <span class="o">==</span> <span class="n">num</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>


<p>引数の数値がkeyの何れかに一致すればOKという感じですね。</p>

<p>で、これをFixnumに代えてPatternにセットすると。テストサンプルも増やして...</p>

<div class="highlight"><pre><code class="ruby"><span class="n">res1</span> <span class="o">=</span> <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res2</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;404&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res3</span> <span class="o">=</span> <span class="o">[</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">]</span>
<span class="n">res4</span> <span class="o">=</span> <span class="o">[</span><span class="mi">301</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res5</span> <span class="o">=</span> <span class="o">[</span><span class="mi">502</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res6</span> <span class="o">=</span> <span class="o">[</span><span class="mi">700</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>

<span class="no">Response</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">HTTP_STATUS</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>

<span class="k">def</span> <span class="nf">response_lint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">res</span>
  <span class="k">when</span> <span class="no">Response</span> <span class="k">then</span> <span class="kp">true</span>
  <span class="k">else</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="p">,</span> <span class="n">res4</span><span class="p">,</span> <span class="n">res5</span><span class="p">,</span> <span class="n">res6</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">response_lint</span> <span class="n">res</span> <span class="p">}</span> <span class="c1"># =&gt; [true, false, false, true, true, false]</span>
</code></pre></div>


<p>いいんじゃないですかー。</p>

<p>caseの自由度がなせる技ですよ。まさに。</p>

<h2>その６</h2>

<p>まあ、もういいんですけど、折角だからコードセクション毎にcaseするっての、どうですか。</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s2">&quot;rack&quot;</span>

<span class="no">HTTP_STATUS</span> <span class="o">=</span> <span class="ss">Rack</span><span class="p">:</span><span class="ss">:Utils</span><span class="o">::</span><span class="no">HTTP_STATUS_CODES</span><span class="o">.</span><span class="n">group_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="n">k</span> <span class="o">/</span> <span class="mi">100</span> <span class="p">}</span>

<span class="mi">5</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
  <span class="n">st</span> <span class="o">=</span> <span class="no">HTTP_STATUS</span><span class="o">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span>
  <span class="k">def</span> <span class="nc">st</span><span class="o">.</span><span class="nf">===</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="n">k</span> <span class="o">==</span> <span class="n">num</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="no">Object</span><span class="o">.</span><span class="n">const_set</span><span class="p">(</span><span class="s2">&quot;HTTP_STATUS_</span><span class="si">#{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">xx&quot;</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Response1xx</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">HTTP_STATUS_1xx</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>
<span class="no">Response2xx</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">HTTP_STATUS_2xx</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>
<span class="no">Response3xx</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">HTTP_STATUS_3xx</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>
<span class="no">Response4xx</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">HTTP_STATUS_4xx</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>
<span class="no">Response5xx</span> <span class="o">=</span> <span class="no">Pattern</span><span class="o">[</span><span class="no">HTTP_STATUS_5xx</span><span class="p">,</span> <span class="no">Hash</span><span class="p">,</span> <span class="no">Enumerable</span><span class="o">]</span>
</code></pre></div>


<p><code>group_by</code>でセクション分けてそれぞれ定数にセットします。で、各セクションには<code>===</code>を定義します。無理矢理感強いですか。</p>

<p>下準備ができたので、いってみますよ。</p>

<div class="highlight"><pre><code class="ruby"><span class="n">res1</span> <span class="o">=</span> <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res2</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;404&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res3</span> <span class="o">=</span> <span class="o">[</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">]</span>
<span class="n">res4</span> <span class="o">=</span> <span class="o">[</span><span class="mi">301</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res5</span> <span class="o">=</span> <span class="o">[</span><span class="mi">502</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>
<span class="n">res6</span> <span class="o">=</span> <span class="o">[</span><span class="mi">700</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="s2">&quot;Welcome to Rack&quot;</span><span class="o">.</span><span class="n">chars</span><span class="o">]</span>

<span class="k">def</span> <span class="nf">response_lint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">res</span>
  <span class="k">when</span> <span class="no">Response1xx</span> <span class="k">then</span> <span class="ss">:&#39;1xx&#39;</span>
  <span class="k">when</span> <span class="no">Response2xx</span> <span class="k">then</span> <span class="ss">:&#39;2xx&#39;</span>
  <span class="k">when</span> <span class="no">Response3xx</span> <span class="k">then</span> <span class="ss">:&#39;3xx&#39;</span>
  <span class="k">when</span> <span class="no">Response4xx</span> <span class="k">then</span> <span class="ss">:&#39;4xx&#39;</span>
  <span class="k">when</span> <span class="no">Response5xx</span> <span class="k">then</span> <span class="ss">:&#39;5xx&#39;</span>
  <span class="k">else</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="p">,</span> <span class="n">res4</span><span class="p">,</span> <span class="n">res5</span><span class="p">,</span> <span class="n">res6</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">response_lint</span> <span class="n">res</span> <span class="p">}</span> <span class="c1"># =&gt; [:&quot;2xx&quot;, false, false, :&quot;3xx&quot;, :&quot;5xx&quot;, false]</span>
</code></pre></div>


<p>いいんじゃないですかね！こんな感じです。</p>

<p>えっ？もっと先は無いのかって？</p>

<p>なら、<code>gem i case</code>してくださいよ、僕はもういっぱいですから。そうですよ、そのまんま<a href="https://rubygems.org/gems/case" title="case | RubyGems.org | your community gem host">case gem</a>。Rubyでパターンマッチ頑張ってるって感じですよ...</p>

<br />


<p>そんなわけで...ご清聴ありがとうございました...</p>

<br />




<br />


<hr />

<p>客観的に見て、ぼくはガツンと言ってやったと思う。「Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たち」を前に、caseが持っている能力をひたすら羅列していった。この思い届けとばかりにガツンと言ってやった。それが彼らに届いたかどうかは、ぼくには分からない。しかしぼくがガツンと言ってやったことだけは確かだ。ぼくは今日Rubyのcaseについて一言申し上げたのだった。</p>

<hr />

<p>それから、もう一言Rubyについて申し上げたいことがある。これは是非とも今日ここで言っておかなければならないことだ。ぼくがRubyを生んだ人やそれを育ててる人たちやそれを盛り上げている人たちに正対して、これを直接述べることができないとしても、これは今日言っておかなければいけない。そしてぼくは言う。</p>

<br />


<p>Ruby、20周年おめでとう</p>

<br />


<br />


<hr />

<p style='color:red'>=== Ruby関連電子書籍100円で好評発売中！ ===</p>


<p><a href="/books/" title="M'ELBORNE BOOKS">M'ELBORNE BOOKS</a></p>

<p><a href="/books/">
  <img src="/assets/images/2012/start_ruby.jpg" alt="start_ruby" style="width:200px" />
</a>
<a href="/books/">
  <img src="/assets/images/2013/02/ruby_object_cover.png" alt="ruby_object" style="width:200px" />
</a>
<a href="/books/">
  <img src="/assets/images/2012/rack_cover.png" alt="rack" style="width:200px" />
</a></p>

<hr />

<p>参考記事：</p>

<p><a href="http://bloggingfrom.tv/wp/2012/06/01/7584">ぼくがはてなブックマークの人に「ガツン」と申し上げたこと - カイ士伝</a></p>

<hr />

<p>(追記：2013-02-26) 一部コードを修正しました。</p>


    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* foot */
      google_ad_slot = "7511276945";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <hr>
    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" class="hatena-bookmark-button" data-hatena-bookmark-title="Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たちにぼくから一言ガツンと申し上げたい" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" data-text="Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たちにぼくから一言ガツンと申し上げたい" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2013/02/19/flippy-console-now-added" title="flippy consoleで上下反転文字の不思議な感覚を味わってみませんか？">&larr; Previous</a></li>
      
        <li><a href="/">Archive</a></li>
        <!--<li><a href="/archive.html">Archive</a></li>-->
      
        <li class="next"><a href="/2013/03/04/ruby-trivias-you-should-know-4" title="知って得する！５５のRubyのトリビアな記法">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'melborne'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span3">
    <div id="bookAd">
      <a href="/books/">
        <!--<img src="/assets/images/2012/start_ruby.jpg" alt="start_ruby" />-->
        <!--<img src="/assets/images/2012/jekyll_cover.jpg" alt="jekyll" />-->
        <!--<img src="/assets/images/2012/ruby_parallel_cover.png" alt="ruby_parallel" />-->
        <!--<img src="/assets/images/2012/js_oop_cover.png" alt="js_oop" />-->
        <!--<img src="/assets/images/2012/rack_cover.png" alt="rack" />-->
        <!--<img src="/assets/images/2013/02/ruby_object_cover.png" alt="ruby_object" />-->
        <img src="/assets/images/2013/03/ruby_trivia_cover.png" alt="ruby_trivia" />
      </a>
      <p id="comment">100円で好評発売中！<br/><a href="/books/">M'ELBORNE BOOKS</a></p>
    </div>

    <hr />
    

    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" class="hatena-bookmark-button" data-hatena-bookmark-title="Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たちにぼくから一言ガツンと申し上げたい" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" data-text="Rubyのcaseを〇〇(言語名)のswitch文だと思っている人たちにぼくから一言ガツンと申し上げたい" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2013/02/25/i-wanna-say-something-about-rubys-case/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>

    <div class="ad" id="sideAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* sidebar */
      google_ad_slot = "0672114662";
      google_ad_width = 160;
      google_ad_height = 600;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>
  </div>
</div>


      </div>

      <footer>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-nc/2.1/jp/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/2.1/jp/88x31.png" /></a>  kyoendo 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>        </p>
      </footer>

    </div> <!-- /container -->

    

    <script type="text/javascript">
      if (location.hostname != 'localhost') {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-288751-18']);
        _gaq.push(['_trackPageview']);
  
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      };
    </script>

    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <script src="/assets/javascripts/jquery-1.7.2.min.js"></script>
    <script src="/assets/javascripts/lightbox.js"></script>

    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>
  </body>
</html>

