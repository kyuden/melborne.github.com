
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    
      <title>Rubyを始めたけど今ひとつRubyのオブジェクト指向というものが掴めないという人、ここに来て見て触って！</title>
    
    <meta name="description" content="" />
    <meta name="author" content="kyoendo" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter-ext/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/themes/twitter-ext/css/style.css?body=1" rel="stylesheet" type="text/css" media="all" />
    <link href="/assets/themes/twitter-ext/css/syntax.css" rel="stylesheet" type="text/css" />
    <link href="/assets/themes/twitter-ext/css/lightbox.css" rel="stylesheet" />
    <link media="only screen and (max-device-width: 480px)" href="/assets/themes/twitter-ext/css/iphone.css" type="text/css" rel="stylesheet" />
    <!--<link media="only screen and (device-width: 768px)" href="/assets/themes/twitter-ext/css/ipad.css" type="text/css" rel="stylesheet" />-->
    <!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />-->
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />-->
<!--<script type="text/x-mathjax-config">-->
  <!--MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });-->
<!--</script>-->
<!--<script type="text/javascript"-->
  <!--src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">-->
<!--</script>-->
  </head>
  <body>
    <div id="fb-root"></div>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="avatar" href="/">
            <img src="http://gravatar.com/avatar/97aa01a6f87da85251be77792dec1d9c?s=80" height="75" width="75" class="avatar" />
          </a>
          <a class="brand" href="/">hp12c</a>
          <div id='rss'>
            <a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon32x32.png" alt="" style="border:0"/></a><a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"></a>
            <!--<a href="/atom.xml" id="rss">-->
              <!--<img src="/assets/images/site/rss.png" alt="rss" title="RSS" height="22" width="22" />-->
            <!--</a>-->
          </div>
          <ul class="nav">
            <li>
            <a class="books" href="/books/">Books</a>
            </li>
            <li>
              <a class="myproducts" href="http://welove.herokuapp.com/?keyword=merborne">Products</a>
            </li>
            
            
            


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
    	
      <li><a href="/tags.html">Tags</a></li>
    	
    
  








            <li class='site'>
              <a href="https://twitter.com/merborne" id="twitter">
                <img src="/assets/images/site/twitter.png" alt="twitter" title="@merborne on Twitter" height="32" width="32" />
              </a>
            </li>
            <li class='site'>
              <a href="https://github.com/melborne" id="github">
                <img src="/assets/images/site/github.png" alt="github" title="@melborne on GitHub" height="24" width="24" />
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header span8">
  <div class="date"><span>07 February 2013</span></div>
  <h1 class='page-title'><a href="/2013/02/07/understand-ruby-object">Rubyを始めたけど今ひとつRubyのオブジェクト指向というものが掴めないという人、ここに来て見て触って！</a> <small>  </small></h1>
</div>

<div class="row">
  <div class="span9">
    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* hp12c */
      google_ad_slot = "7055414638";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <p>Rubyのオブジェクト指向は一貫性があってわかりやすいという評判だけれども、オブジェクトを意識しない便利な手続き的な書き方もできるからそれがRubyの本来の姿を分かり難くしているという面もあってその辺でRubyを始めたけど今ひとつ本質的なものが見えてこない人たちもいるんじゃないかと思う今日此の頃ですが皆さんいかがお過ごしですか？</p>

<p>それで随分と前に僕がRubyを始めてそんなに時間が経っていないときに書いたブログの記事があってそのことを思い出して、読み返してみるとRubyのオブジェクトを中心にしたちょっとユニークな説明になっていてまあ書き足りない部分もあるけれどもあの頃の知識でよく書けてるじゃないのなどと自画自賛しつつ、これは先の「Rubyを始めたけど今ひとつ本質的なものが見えてこない人たち」の役にも立つのではないかという発想が生まれて、結果ここにその記事群の文体を変えたり間違いを直したり挿絵を入れたりして加筆修正したものを再掲しましたのでどなたかのお役に立てれば幸いです。</p>

<p>加えて昨年12月より始めている「このブログの記事を電子書籍化してGumroadで販売する」という僕の個人プロジェクトがあるんだけれどもこの記事をその一冊に加えましたので電子書籍版に興味があったりまあ無くてもお試し的なノリとか応援的なノリとか冷やかし的なノリとかで買ってもいいぜよ100円ならとおっしゃる方などが居られましたら、是非ともご検討のほどよろしくお願いしますm(__)m</p>

<blockquote><p><a href="/books/" title="M'ELBORNE BOOKS">M'ELBORNE BOOKS</a></p></blockquote>

<p><img src="/assets/images/2013/02/ruby_object_cover.png" alt="Alt title" /></p>

<hr />

<h2>１章　Rubyにおけるオブジェクトの種類</h2>

<p>Rubyはオブジェクト指向言語であり、Ruby実行空間に存在するオブジェクトをその操作対象とします。Ruby実行空間には３種類のオブジェクト、すなわち「インスタンスオブジェクト」、「クラスオブジェクト」、そして「モジュールオブジェクト」が存在しています。これらは通常単に、「オブジェクト（またはインスタンス）」、「クラス」、「モジュール」と呼ばれています。以下順に各オブジェクトの特徴について説明していきます。</p>

<h2>２章　クラスオブジェクト ─クラスとしての顔─</h2>

<p>クラスオブジェクトは通常単に「クラス」と呼ばれ、主にRuby実行空間にオブジェクトを生み出すために存在します。生み出されるオブジェクトのデザインは、クラスに記述されており、ユーザがオブジェクトにアクセスしてその機能を実現しようとするとき、オブジェクトはクラスからその機能を借り出します。</p>

<p>Rubyにはその設計者により予め多数のクラスが用意されています。これらは組み込みクラスと呼ばれます。ユーザは組み込みクラスを自由に使えますが、<strong>class</strong>式を使って独自クラスを定義することもできます。<strong>Creature</strong>クラスを定義してみましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>


<p>仮に、ユーザがclass式を使って既存クラスと同名のクラスを定義した場合、それは既存クラスの書き換えではなく拡張となります。その既存クラスが本来持っている機能は失われず、新たな機能がそこに付加されることになるのです。<strong>String#expand</strong>を定義します。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">String</span>
  <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/./</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">my_name</span> <span class="o">=</span> <span class="s2">&quot;charlie&quot;</span>
<span class="n">my_name</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 7</span>
<span class="n">my_name</span><span class="o">.</span><span class="n">expand</span> <span class="c1"># =&gt; &quot;cchhaarrlliiee&quot;</span>
</code></pre></div>


<p>もっとも同名のメソッドを再定義すれば、それは基のメソッドの上書きになるので注意を要します。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">String</span>
  <span class="k">def</span> <span class="nf">length</span>
    <span class="s2">&quot;I don&#39;t wanna tell you.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="s2">&quot;Charlie&quot;</span><span class="o">.</span><span class="n">length</span>  <span class="c1"># =&gt; &quot;I don&#39;t wanna tell you.&quot;</span>
</code></pre></div>


<p>特定のクラスからオブジェクトを生成するには、<strong>new</strong>メソッドを使います。"Doggie"という名の生物を生成しましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Creatureクラスのnewメソッドでオブジェクトを生成する</span>
<span class="n">my_pet</span> <span class="o">=</span> <span class="no">Creature</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Doggie&#39;</span><span class="p">)</span> 
</code></pre></div>


<p>一方で、代表的な組み込みクラスでは「リテラル表記」を使って、簡易にオブジェクトを生成することができます。</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># 文字列オブジェクトの生成</span>
<span class="n">my_name</span> <span class="o">=</span> <span class="s2">&quot;Charlie&quot;</span>
<span class="c1"># 整数オブジェクトの生成</span>
<span class="n">my_age</span> <span class="o">=</span> <span class="mi">195</span>
<span class="c1"># 配列オブジェクトの生成</span>
<span class="n">my_pets</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;Dog&#39;</span><span class="p">,</span> <span class="s1">&#39;Crocodile&#39;</span><span class="p">,</span> <span class="s1">&#39;Hippopotamus&#39;</span> <span class="o">]</span>
<span class="c1"># ハッシュオブジェクトの生成</span>
<span class="n">my_favorite</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:number</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">:language</span> <span class="o">=&gt;</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">,</span> <span class="ss">:color</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blue&#39;</span> <span class="p">}</span> 
<span class="c1"># 範囲オブジェクトの生成</span>
<span class="n">my_range</span> <span class="o">=</span> <span class="mi">9</span><span class="o">.</span><span class="n">.</span><span class="mi">21</span>
<span class="c1"># 正規表現オブジェクトの生成</span>
<span class="n">my_regexp</span> <span class="o">=</span> <span class="sr">/ruby/</span> 
</code></pre></div>


<p>オブジェクトの特性はそのクラスのメソッド定義でほぼ決まります。既に見てきたように、メソッドは<strong>def</strong>式を使って定義できます。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="vi">@name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>


<p>クラスに定義されるこの種のメソッドを「インスタンスメソッド」と呼びます。インスタンスメソッドはこのクラスから派生するオブジェクトの挙動を決定付けます。つまり、クラスからオブジェクトが生成されたとき、インスタンスメソッドがあたかも、オブジェクト自身が持つメソッドのように振る舞います。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">my_pet</span> <span class="o">=</span> <span class="no">Creature</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Doggie&#39;</span><span class="p">)</span>
 <span class="n">my_pet</span><span class="o">.</span><span class="n">name</span>   <span class="c1"># =&gt; &quot;Doggie&quot;</span>
</code></pre></div>


<h2>３章　クラスオブジェクト ─オブジェクトとしての顔─</h2>

<p>確かにクラスはオブジェクトを生成するための雛形的なものです。しかし同時に、クラスはそれ自身もRuby実行空間に存在するオブジェクトなのです。</p>

<p>オブジェクトにクラスという母があるように、すべてのクラスにも<strong>Class</strong>クラスという母があります。</p>

<p>つまりすべてのクラスの雛形となっているのはClassクラスであり、クラスはすべてここから生成されているのです。<strong>class</strong>メソッドでこの事実を知ることができます（一部のクラスは省略しています）。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Object</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="nb">Array</span><span class="o">.</span><span class="n">class</span>            <span class="c1"># =&gt; Class</span>
<span class="no">Binding</span><span class="o">.</span><span class="n">class</span>          <span class="c1"># =&gt; Class</span>
<span class="no">Data</span><span class="o">.</span><span class="n">class</span>             <span class="c1"># =&gt; Class</span>
<span class="no">Exception</span><span class="o">.</span><span class="n">class</span>        <span class="c1"># =&gt; Class</span>
<span class="no">Dir</span><span class="o">.</span><span class="n">class</span>              <span class="c1"># =&gt; Class</span>
<span class="no">Encoding</span><span class="o">.</span><span class="n">class</span>         <span class="c1"># =&gt; Class</span>
<span class="no">Enumerator</span><span class="o">.</span><span class="n">class</span>       <span class="c1"># =&gt; Class</span>
<span class="ss">File</span><span class="p">:</span><span class="ss">:Stat</span><span class="o">.</span><span class="n">class</span>       <span class="c1"># =&gt; Class</span>
<span class="no">Hash</span><span class="o">.</span><span class="n">class</span>             <span class="c1"># =&gt; Class</span>
<span class="no">IO</span><span class="o">.</span><span class="n">class</span>               <span class="c1"># =&gt; Class</span>
<span class="no">File</span><span class="o">.</span><span class="n">class</span>             <span class="c1"># =&gt; Class</span>
<span class="no">MatchData</span><span class="o">.</span><span class="n">class</span>        <span class="c1"># =&gt; Class</span>
<span class="no">Method</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">Module</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">Numeric</span><span class="o">.</span><span class="n">class</span>          <span class="c1"># =&gt; Class</span>
<span class="no">Proc</span><span class="o">.</span><span class="n">class</span>             <span class="c1"># =&gt; Class</span>
<span class="ss">Process</span><span class="p">:</span><span class="ss">:Status</span><span class="o">.</span><span class="n">class</span>  <span class="c1"># =&gt; Class</span>
<span class="no">Random</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">Range</span><span class="o">.</span><span class="n">class</span>            <span class="c1"># =&gt; Class</span>
<span class="no">Regexp</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="nb">String</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">Struct</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">Symbol</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">Thread</span><span class="o">.</span><span class="n">class</span>           <span class="c1"># =&gt; Class</span>
<span class="no">ThreadGroup</span><span class="o">.</span><span class="n">class</span>      <span class="c1"># =&gt; Class</span>
<span class="no">Time</span><span class="o">.</span><span class="n">class</span>             <span class="c1"># =&gt; Class</span>
<span class="no">UnboundMethod</span><span class="o">.</span><span class="n">class</span>    <span class="c1"># =&gt; Class</span>
<span class="no">TrueClass</span><span class="o">.</span><span class="n">class</span>        <span class="c1"># =&gt; Class</span>
<span class="no">FalseClass</span><span class="o">.</span><span class="n">class</span>       <span class="c1"># =&gt; Class</span>
<span class="no">NilClass</span><span class="o">.</span><span class="n">class</span>         <span class="c1"># =&gt; Class</span>
</code></pre></div>


<p>そうなると、Classクラスの母は一体誰なのかという疑問が持ち上がります。Classクラスにclassメソッドを送ってこの疑問に答えましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Class</span><span class="o">.</span><span class="n">class</span> <span class="c1"># =&gt; Class</span>
</code></pre></div>


<p>驚くべきことに、Classクラスの母もこのClassクラス自身だったのです！</p>

<p>あなたが後から作るクラスも、その母はあなたではなくClassクラスです。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Creature</span><span class="o">.</span><span class="n">class</span> <span class="c1"># =&gt; Class</span>
</code></pre></div>


<p>またある特定のクラスのサブクラスもその母はスーパークラスではなく、Classクラスです。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">Creature</span>  <span class="c1"># CreatureクラスのサブクラスPersonを定義</span>

<span class="k">end</span>

<span class="no">Person</span><span class="o">.</span><span class="n">class</span> <span class="c1"># =&gt; Class</span>
</code></pre></div>


<p>兎にも角にも、あらゆるクラスは、<strong>Class</strong>という一つのクラスから生成されているのです。</p>

<p>つまりRuby実行空間には、最初にClassクラスから生成されたClassクラスがあり、そのClassクラスが次いで他のすべてのクラスを生成し、最後にこの生成された各種のクラスからオブジェクトが生成される、という構図が描かれます。</p>

<p><img src="/assets/images/2013/02/ruby_class.png" alt="Alt title noshadow" /></p>

<br clear='all' />


<p>クラスからオブジェクトを生成するときはユーザがnewメソッドを使ってその生成を明示し、これを変数などに格納してアクセスできるようにする必要があります。しかしクラスの生成にその必要はありません。class定義式の解析時にRubyが自動でそれらを生成します。生成されたクラスにはそのクラス名を冠した定数が付けられ、これによりユーザによるクラスへのアクセスが可能になります。</p>

<p>このことを確認するために、恣意的にClassクラスのnewクラスメソッドを使ってクラスを生成してみましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="no">Creature</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Creature</span><span class="p">)</span> <span class="c1"># !&gt; already initialized constant Creature</span>
<span class="c1"># &gt;&gt; Creature</span>
</code></pre></div>


<p>これによりCreature定数には既にCreatureクラスがセットされていることが確認できます。なお上記によりCreatureクラスのサブクラスが生成され、それがCreature定数に再設定されたことになります。</p>

<p>クラスには自身のためのselfメソッドを定義できます。これは通常「クラスメソッド」と呼ばれます。クラスに対しクラスメソッドを直接呼び出すことによって、クラス自身にアクセスできます。クラスメソッドはそこから派生したオブジェクト全体を管理するためなどに使うことができます。</p>

<p>Creatureクラスにそこから派生したオブジェクトの数を返す<strong>count</strong>クラスメソッドを定義します。def式においてメソッド名の前に<strong>self</strong>を置くことでクラスメソッドが定義できます。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="vc">@@counter</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="vc">@@counter</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">count</span>
    <span class="s2">&quot;You have </span><span class="si">#{</span><span class="vc">@@counter</span><span class="si">}</span><span class="s2"> creatures.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">dog</span> <span class="o">=</span> <span class="no">Creature</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hot&#39;</span><span class="p">)</span>
<span class="n">alligator</span> <span class="o">=</span> <span class="no">Creature</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;thanks&#39;</span><span class="p">)</span>
<span class="n">hippopotamus</span> <span class="o">=</span> <span class="no">Creature</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;idiot&#39;</span><span class="p">)</span>

<span class="no">Creature</span><span class="o">.</span><span class="n">count</span>  <span class="c1"># =&gt; &quot;You have 3 creatures.&quot;</span>
</code></pre></div>


<h2>４章　継承（Inheritance）</h2>

<p>「継承」とはクラス間の相互依存関係のことです。Rubyではあるクラスが定義したメソッドを、あたかも自分に定義されたもののように他のクラスが利用できます。利用される側をスーパークラス、利用する側をサブクラスと呼びます。</p>

<p>他のクラスを利用してクラスを定義する場合、自分の名前にスーパークラス名を接ぎ木します。CreatureクラスをスーパークラスとするPersonクラスを定義します。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="vi">@name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">Creature</span>  <span class="c1"># CreatureクラスのサブクラスPersonを定義</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span><span class="n">age</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@age</span> <span class="o">=</span> <span class="n">age</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">age</span>
   <span class="vi">@age</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">me</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">me</span><span class="o">.</span><span class="n">name</span>   <span class="c1"># =&gt; &quot;Charlie&quot;</span>
<span class="n">me</span><span class="o">.</span><span class="n">age</span>    <span class="c1"># =&gt; 8</span>
</code></pre></div>


<p>こうすればサブクラスPersonのインスタンスであるmeオブジェクトでも、自ら定義することなくメソッドnameが使えるようになります。つまり、me.nameが実行されたとき、このメッセージは最初Personクラスに送られて、そこで対応するnameメソッドが存在しないことが分かると、次いでそのスーパークラスに渡され実行されます（モジュールの話はここでは割愛します）。</p>

<p>一般的に言えば、Rubyはメッセージに対応するメソッドが見つかるまでクラスツリーを遡り、最後にはObjectクラス（正確にはBasicObjectクラス）に至ります。</p>

<p>一つのクラスは同時並行的に複数のクラスと継承関係になれません。つまり複数のスーパークラスを同時に持てないのです。このような制限を、制限のない「多重継承」に対して「単純継承」といいます。</p>

<p>しかし他のクラスのサブクラスをスーパークラスにすることはできます。この数つまり経時直線的な段数に制限はありません。CreatureクラスのサブクラスであるPersonクラスをスーパークラスとして、PersonInEarthを定義してみましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">PersonInEarth</span> <span class="o">&lt;</span> <span class="no">Person</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="vi">@country</span> <span class="o">=</span> <span class="n">country</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">country</span>
    <span class="vi">@country</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">a_friend</span> <span class="o">=</span> <span class="no">PersonInEarth</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Fernando&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s2">&quot;Spain&quot;</span><span class="p">)</span>
<span class="n">a_friend</span><span class="o">.</span><span class="n">name</span>    <span class="c1"># &gt;&gt; &quot;Fernando&quot;</span>
<span class="n">a_friend</span><span class="o">.</span><span class="n">country</span> <span class="c1"># &gt;&gt; &quot;Spain&quot;</span>
</code></pre></div>


<p>この継承関係を図に示します。</p>

<p><img src="/assets/images/2013/02/ruby_inherit.png" alt="ruby inheritance noshadow" /></p>

<br clear='all' />


<p>誰がスーパークラスかはsuperclassメソッドで調べることができます。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">PersonInEarh</span><span class="o">.</span><span class="n">superclass</span> <span class="c1"># &gt;&gt; Person</span>
</code></pre></div>


<p>Rubyでは継承関係にない独立したクラスというのは作れません。クラス定義においてスーパークラスを指定しないとき、Rubyは勝手にObjectクラスをそのスーパークラスにセットします。つまりすべてのクラスはObjectクラスのサブクラスなのです。組み込みクラスも例外ではありません。</p>

<p>何も定義しないクラスでmethodsメソッドを呼べば、それが既にObjectクラスのサブクラスになっていることが確認できます（このメソッドを呼べること自体が証拠です）。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Nothing</span>

<span class="k">end</span>
<span class="n">n</span> <span class="o">=</span> <span class="no">Nothing</span><span class="o">.</span><span class="n">new</span>
<span class="no">Nothing</span><span class="o">.</span><span class="n">superclass</span> <span class="c1"># =&gt; Object</span>
<span class="n">n</span><span class="o">.</span><span class="n">methods</span> <span class="c1"># =&gt; [:nil?, :===, :=~, :!~, :eql?, :hash, :&lt;=&gt;, :class, :singleton_class, :clone, :dup, :initialize_dup, :initialize_clone, :taint, :tainted?, :untaint, :untrust, :untrusted?, :trust, :freeze, :frozen?, :to_s, :inspect, :methods, :singleton_methods, :protected_methods, :private_methods, :public_methods, :instance_variables, :instance_variable_get, :instance_variable_set, :instance_variable_defined?, :instance_of?, :kind_of?, :is_a?, :tap, :send, :public_send, :respond_to?, :respond_to_missing?, :extend, :display, :method, :public_method, :define_singleton_method, :object_id, :to_enum, :enum_for, :==, :equal?, :!, :!=, :instance_eval, :instance_exec, :__send__, :__id__]</span>
</code></pre></div>


<p>NothingクラスはObjectクラスが持っているすべてのメソッドを継承しています。</p>

<p>継承はクラス間の師弟制度のようなものです。とりわけ、Rubyの継承は一子相伝、一人がそのすべてを引き継ぐという特徴を有します。この特徴のため、継承関係が成熟しクラス階層が限りなきものになったとしても、Rubyは迷うことなくその末端から頂点、つまりObjectクラスまでを遡ることができるのです。</p>

<p>基本的にサブクラスはスーパークラスの特性をすべて引き継ぎますが、サブクラスにおいてその一部を拒否したり再定義することは許されます。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">PersonInEarth</span> <span class="o">&lt;</span> <span class="no">Person</span>
  <span class="k">undef</span> <span class="ss">:age</span>  <span class="c1"># ageメソッドを未定義にする</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">country</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span><span class="n">age</span><span class="p">)</span>
    <span class="vi">@country</span> <span class="o">=</span> <span class="n">country</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">country</span>
    <span class="vi">@country</span>
  <span class="k">end</span>

  <span class="k">alias</span> <span class="ss">:name_old</span> <span class="ss">:name</span>  <span class="c1">#nameメソッドをname_oldに変える</span>
  <span class="k">def</span> <span class="nf">name</span>   <span class="c1"># nameメソッドを再定義する</span>
    <span class="s2">&quot;my name is </span><span class="si">#{</span><span class="n">name_old</span><span class="si">}</span><span class="s2">.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">a_friend</span> <span class="o">=</span> <span class="no">PersonInEarth</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Fernand&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s2">&quot;Spain&quot;</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">a_friend</span><span class="o">.</span><span class="n">name</span> <span class="c1"># &gt;&gt; &quot;my name is Fernand.&quot;</span>
<span class="nb">p</span> <span class="n">a_friend</span><span class="o">.</span><span class="n">age</span>
  <span class="c1"># ~&gt; -:39: undefined method `age` for #&lt;PersonInEarth:0x23550&gt; (NoMethodError)</span>
</code></pre></div>


<h2>５章　モジュールオブジェクト</h2>

<p>単純継承はメソッド探索の複雑さを排除します。一方で継承の本来的意義を低下させ得ます。仮に異なる系譜の継承クラス群があり、その両方の系譜の特性を持ったクラスを生成したい場合、単純継承ではそれを一方の系譜のサブクラスとし、そこに他方の系譜の特性すべてを一から書き足す必要が生じます。これは継承の目的に反し極めて非生産的です。</p>

<p>Rubyでは「モジュール」がこの問題を最小化します。</p>

<p>モジュールは、継承関係に立つことができない独立したクラスです。そこからオブジェクトを生成することもできません。モジュールはその中に特定の機能のまとまりを持って、クラスに「Mix-in」つまり挿し木されます。モジュールをMix-inしたクラスは追加的にその機能を獲得することになります。ここでは<strong>Behavior</strong>モジュールを定義して、PersonInEarhクラスにMix-inしてみます。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">module</span> <span class="nn">Behavior</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">description</span>  <span class="c1"># モジュールメソッドの定義</span>
    <span class="s2">&quot;I&#39;m a Behavior Module.&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sleep</span>  <span class="c1"># インスタンスメソッドの定義</span>
    <span class="s2">&quot;I&#39;m sleeping.&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">eat</span>
    <span class="s2">&quot;I&#39;m eating.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PersonInEarth</span> <span class="o">&lt;</span> <span class="no">Person</span>
  <span class="kp">include</span> <span class="no">Behavior</span>  <span class="c1"># Behaviorモジュールを読み込む</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">country</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span><span class="n">age</span><span class="p">)</span>
    <span class="vi">@country</span> <span class="o">=</span> <span class="n">country</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">country</span>
    <span class="vi">@country</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">a_friend</span> <span class="o">=</span> <span class="no">PersonInEarth</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Fernand&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s2">&quot;Spain&quot;</span><span class="p">)</span>
<span class="n">a_friend</span><span class="o">.</span><span class="n">eat</span> <span class="c1"># =&gt; &quot;I&#39;m eating.&quot;</span>
<span class="n">a_friend</span><span class="o">.</span><span class="n">sleep</span> <span class="c1"># =&gt; &quot;I&#39;m sleeping.&quot;</span>
<span class="no">Behavior</span><span class="o">.</span><span class="n">description</span> <span class="c1"># =&gt; &quot;I&#39;m a Behavior Module.&quot;</span>
</code></pre></div>


<p>モジュールの定義は<strong>module</strong>式で行います。クラスと同様モジュールには、オブジェクトのためのインスタンスメソッドと、自身のためのselfメソッドとを定義できます。モジュールのselfメソッドは一般に「モジュールメソッド」と呼ばれています。</p>

<p>クラスにモジュールをMix-inするには<strong>include</strong>メソッドを使います。これによりあたかも、モジュールで定義したメソッドがクラスにあるかのように働きます。よって、クラスから生成されたオブジェクトは、それらのインスタンスメソッドを自由に使えるようになります。</p>

<p>もっとも、モジュールのselfメソッドがMix-in先クラスのselfメソッドとして働くことはありません。つまりモジュールメソッドはクラスメソッドにはならないのです。この点が継承の場合とは異なっています。</p>

<p>モジュールのMix-inによって継承におけるメソッド探索のルートが変わります。モジュールをMix-inしたクラス内が探索されると、そのスーパークラスに先立ってモジュール内が探索されます。多重継承におけるようなあいまいさはありません。<strong>ancestors</strong>メソッドでその順位を確認できます。PersonInEarthクラスでそれを確認します。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">PersonInEarth</span><span class="o">.</span><span class="n">ancestors</span> <span class="c1"># =&gt; [PersonInEarth, Behavior, Person, Creature, Object, Kernel, BasicObject]</span>
</code></pre></div>


<p>PersonInEarthにおける継承関係とモジュールの位置づけを図にすると以下のようになります。</p>

<p><img src="/assets/images/2013/02/ruby_module.png" alt="Alt title noshadow" /></p>

<br clear='all' />


<p>オブジェクトにとって、その母がクラスであるならば、モジュールは、彼のベビーシッターのような存在です。母に代わって子をヘルプします。現実のベビーシッターがそうであるように、モジュールは、複数のクラスにおいて掛け持ちされ得ます。</p>

<p>なお、モジュールは継承関係には立てませんが、モジュールに他のモジュールをMix-inすることはできます。しかし最終的にモジュールはクラスにMix-inされ、その継承関係に割り込まなければ機能しません（モジュールメソッドは直接呼ぶことができます）。</p>

<h2>６章　インスタンスオブジェクト</h2>

<p>インスタンスオブジェクトは通常単に「オブジェクト」あるいは「インスタンス」と呼ばれ、先に書いたようにクラスをnewすることでRuby実行空間に生み出されます。</p>

<p>Ruby実行空間では、各種のクラスから生み出された多数のオブジェクトが、順次・分岐・繰り返しの制御構造の中で相互に働き掛けあうことによって、ユーザの所望する意味のある結果が返されることになります。</p>

<p>Rubyでは「オブジェクト」が主役です。</p>

<p>ところがその存在の重みとは裏腹に、オブジェクトの中身はほとんど空です。基本的にオブジェクトは自分の属性情報のみを保持し、他のオブジェクトとの相互作用のためのメソッド群を保持しません。つまりインスタンスオブジェクトは、自分が何者で誰が親なのかということは知っているけれども、ユーザから送られてくるメッセージの処理方法を知らないということです。</p>

<p>オブジェクトへのアクセスはそれにメッセージを送ることで達成されます。より正確には、メッセージを送る以外にオブジェクトにアクセスする手段はありません。</p>

<p>結局、メッセージを受け取ったオブジェクトは、それを自分の生成元のクラスに投げ、彼女がオブジェクトに代わって答えを用意します。そのクラス自身が対応するメソッドを備えていない場合、先に書いたように、モジュールを含むクラスツリーを辿ってメソッドが探索されます。</p>

<p>PersonInEarthクラスの例で、メソッド探索の手順を追ってみましょう。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="vi">@name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">Creature</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@age</span> <span class="o">=</span> <span class="n">age</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">age</span>
    <span class="vi">@age</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">Behavior</span>
  <span class="k">def</span> <span class="nf">sleep</span>
    <span class="s2">&quot;I&#39;m sleeping.&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">eat</span>
    <span class="s2">&quot;I&#39;m eating.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PersonInEarth</span> <span class="o">&lt;</span> <span class="no">Person</span>
  <span class="kp">include</span> <span class="no">Behavior</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="vi">@country</span> <span class="o">=</span> <span class="n">country</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">country</span>
    <span class="vi">@country</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">a_friend</span> <span class="o">=</span> <span class="no">PersonInEarth</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Fernando&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s2">&quot;Spain&quot;</span><span class="p">)</span>

<span class="c1"># a_friendでラベル付けされたオブジェクトにメッセージnameを送る</span>
<span class="n">a_friend</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &quot;Fernando&quot;</span>
</code></pre></div>


<p>この例でa_friendでラベル付けされたオブジェクトは、メッセージnameを受け取るとこれをその生成元であるPersonInEarthクラスへ送ります（後で述べるSingletonメソッドがある場合はまずそれを探索します）。PersonInEarthでは対応するnameメソッドを呼び出すために、まず自分自身がそれを持っているかが調べられます。次いで、そこにincludeしたBehaviorモジュール内が探索されます。PersonInEarthおよびBehaviorモジュールはnameメソッドを持っていないので、メッセージは今度はそのスーパークラスであるPersonに渡されます。</p>

<p>ところが、Personクラスもnameメソッドを備えていないので、メッセージは更にそのスーパークラスであるCreatureクラスに渡されることになります。そしてここに定義されたnameメソッドが実行され、その結果が順次逆のルートを辿って、a_friendでラベル付けされたオブジェクトからユーザに返されるのです。</p>

<h2>７章　Singletonメソッド（抽象メソッド）</h2>

<p>オブジェクトの中身はほとんど空であるということを書きました。しかしオブジェクトはクラスやモジュールと同様に、その内部にselfメソッドを持つことができます。オブジェクトにおけるselfメソッドは、「Singletonメソッド」または「抽象メソッド」などと呼ばれています。</p>

<p>Singletonメソッドは、そのオブジェクト固有のメソッドを定義するために使われます。</p>

<div class="highlight"><pre><code class="ruby"><span class="n">a_friend</span> <span class="o">=</span> <span class="no">PersonInEarth</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Fernand&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s2">&quot;Spain&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nc">a_friend</span><span class="o">.</span><span class="nf">name</span>
  <span class="s2">&quot;My friend, </span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">a_friend</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &quot;My friend, Fernando&quot;</span>
</code></pre></div>


<p>メソッド定義におけるメソッド名の前にオブジェクトを置くことによって、そのオブジェクトのSingletonメソッドが定義できます。Singletonメソッドはクラスツリーの最下層に位置し、メソッド探索において最優先の探索先となります。</p>

<p>正確に記せばSingletonメソッドは、そのオブジェクト自身に定義されているのではなく、そのオブジェクトとそのクラスとの間に生成される、<strong>無名のクラス</strong>に定義されます。したがってこの無名クラスにSingletonメソッドを定義しても同様の結果が得られます。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">a_friend</span>
  <span class="k">def</span> <span class="nf">name</span>
    <span class="s2">&quot;My friend, </span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">a_friend</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &quot;My friend, Fernando&quot;</span>
</code></pre></div>


<p>class名を無名とし、オブジェクト名を二重の接ぎ木記号で繋ぎます（感情的には接ぎ木の向きは逆ですが）。複数のSingletonメソッドをまとめて定義する場合、この書式が有用です。この無名クラスは「Singletonクラス」とも呼ばれます。</p>

<p><img src="/assets/images/2013/02/ruby_singleton.png" alt="Alt title noshadow" /></p>

<br clear='all' />


<p>Singletonクラスはクラスメソッドやモジュールメソッドを定義する場合にも使えます。</p>

<h2>８章　extend</h2>

<p>なおSingletonクラスはクラスに他ならないので、当然そこにモジュールをMix-inできます。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">module</span> <span class="nn">Business</span>
  <span class="k">def</span> <span class="nf">job</span>
    <span class="s2">&quot;Programmer&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">a_friend</span>
  <span class="kp">include</span> <span class="no">Business</span>
<span class="k">end</span>

<span class="n">a_friend</span><span class="o">.</span><span class="n">job</span> <span class="c1"># =&gt; &quot;Programmer&quot;</span>
</code></pre></div>


<p>SingletonクラスにMix-inされたBusinessモジュールのjobメソッドは、a_friendオブジェクトのSingletonメソッドになります。</p>

<p>しかしRubyではもっと簡単に、モジュールメソッドをSingletonメソッドとしてMix-inする方法があります。それが「extend」です。</p>

<p>SingletonメソッドがSingletonクラスのメソッドを直接オブジェクトに追加できるようにするのと同様、extendはモジュールのメソッドを直接オブジェクトに追加できるようにします。</p>

<div class="highlight"><pre><code class="ruby"><span class="n">a_friend</span><span class="o">.</span><span class="n">extend</span> <span class="no">Business</span>

<span class="n">a_friend</span><span class="o">.</span><span class="n">job</span> <span class="c1"># =&gt; &quot;Programmer&quot;</span>
</code></pre></div>


<p>これによりモジュール内メソッドは特定のオブジェクトの機能になります。</p>

<p><img src="/assets/images/2013/02/ruby_extend.png" alt="Alt title noshadow" /></p>

<br clear='all' />


<h2>９章　まとめ</h2>

<p>最後にクラス、モジュールおよびオブジェクトの特性を整理しておきましょう。</p>

<ol>
<li>すべてのクラスは、Classクラスから生成される。</li>
<li>クラスは、オブジェクトの雛形となり、それを生み出す母のような存在である。</li>
<li>それと共にそれ自身もオブジェクトである。</li>
<li>クラスは、オブジェクトのためのインスタンスメソッドと自身のためのクラスメソッドを持てる。</li>
<li>クラスは、継承によって他のクラスのメソッドを利用できる。</li>
<li>すべてのクラスは継承に係わっていて、その頂点にはObjectクラスがいる。</li>
<li>Rubyの継承は、スーパークラスを唯一つしか持たない単純継承である。</li>
<li>しかし継承の経時直線的な段数には制限はない。</li>
<li>モジュールは、クラスに代わってオブジェクトを支援する、ベビーシッターのような存在である。</li>
<li>モジュールは継承関係に係われず、オブジェクトを生成することもできない。</li>
<li>モジュール自身もオブジェクトであり、インスタンスメソッドの他に自身のためのモジュールメソッドを持てる。</li>
<li>オブジェクトは、クラスから生成される。</li>
<li>オブジェクトがRuby実行空間における主役である。</li>
<li>オブジェクトには、メッセージ送信以外にアクセス方法がない。</li>
<li>オブジェクトに送られたメッセージは、クラスツリーに従って順次クラスに渡される。</li>
<li>オブジェクト自身も固有のメソッドを持てる。</li>
</ol>


<h2>付録１　RubyのObjectクラスは過去を再定義するタイムマシンだ！</h2>

<p>Objectクラスはすべてのクラスのスーパークラスです。よってObjectクラスに定義されたインスタンスメソッドoは、すべてのクラスで定義されたインスタンスメソッドoになります。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Object</span>
  <span class="k">def</span> <span class="nf">o</span>
    <span class="s1">&#39;o&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">MyClass</span>

<span class="k">end</span>

<span class="no">Object</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
<span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
<span class="no">Hash</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
<span class="no">MyClass</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
</code></pre></div>


<p>ClassクラスもObjectクラスのサブクラスなので、このインスタンスメソッドoは当然、Classクラスのインスタンスメソッドoにもなります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
</code></pre></div>


<p>一方、Classクラスはすべてのクラスの生成クラスです。よってClassクラスのインスタンスメソッドとなったoは、すべてのクラスのクラスメソッドself.oになります。</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">Array</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
<span class="no">Hash</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
<span class="no">MyClass</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
</code></pre></div>


<p>この中には当然Objectクラスが含まれているので、Classクラスのインスタンスメソッドoは、Objectクラスのクラスメソッドself.oにもなります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Object</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
</code></pre></div>


<p>ところが、ObjectクラスはClassクラスのスーパークラスなので、Objectクラスのクラスメソッドになったself.oはClassクラスのクラスメソッドself.oにもなります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Class</span><span class="o">.</span><span class="n">o</span> <span class="c1"># =&gt; &quot;o&quot;</span>
</code></pre></div>


<p>整理しましょう。</p>

<p>Objectクラスが１つのインスタンスメソッドoを持つと、それがClassクラスを含むすべてのクラスのインスタンスメソッドoとなり、Objectを含むすべてのクラスのクラスメソッドself.oとなり、Classクラスのクラスメソッドself.oとなります。こうしてRuby実行空間に存在するすべてのクラスには、インスタンスメソッドoとクラスメソッドself.oが生まれることとなるのです。</p>

<p>ClassクラスはObjectクラスを含むすべてのクラスの母です。従って、すべてのクラスはClassクラスの特性に依存します。一方でClassクラスはその子であるObjectクラスの弟子（サブクラス）です。従って、ClassクラスはObjectクラスの特性を受け継ぎます。</p>

<p>このような多層的循環構造によってObjectクラスが変わると、Classクラスが変わり、その変化はすべてのクラスを変えるのです。つまりObjectクラスへのオペレーションは、過去の事実（Classクラス）を再定義し、延いては今の世界（すべてのクラス）を再構築するのです！</p>

<p>そうRubyのObjectクラスは...</p>

<p>「時空を超えて過去を再定義し、世界を再構築するタイムマシン」なのです！</p>

<p>ところでObjectクラスにはKernelモジュールがincludeされています。モジュールに定義されたインスタンスメソッドはそれをincludeしたクラスのものになるので、KernelモジュールのインスタンスメソッドはObjectクラスのものになります。</p>

<p>つまりKernelモジュールはObjectクラスに過去を変えるためのメソッドを補給します。Kernelモジュールから補給されたメソッドは、Objectクラスに定義されたメソッドとして同様に、過去を再定義し今の世界を再構築します。</p>

<p>そうRubyのKernelモジュールは...</p>

<p>「タイムマシン補助燃料タンク」だったのです！</p>

<h2>付録２　RubyのModuleクラスはすべてのモジュールの母であり同時にすべてのクラスの父である！</h2>

<p>Moduleクラスはすべてのモジュールの生成クラスです。よってModuleクラスに定義されたインスタンスメソッドmは、すべてのモジュールで定義されたモジュールメソッドself.mになります。</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Module</span>
  <span class="k">def</span> <span class="nf">m</span>
    <span class="s1">&#39;m&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Module</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
<span class="no">Kernel</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
<span class="no">Enumerable</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
<span class="no">Math</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
</code></pre></div>


<p>またModuleクラスはClassクラスのスーパークラスでもあります。よってModuleクラスに定義されたインスタンスメソッドmは、Classクラスで定義されたインスタンスメソッドmになります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
</code></pre></div>


<p>ここで、Classクラスはすべてのクラスの生成クラスです。よってClassクラスのインスタンスメソッドとなったmは、すべてのクラスのクラスメソッドself.mになります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Object</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
<span class="nb">Array</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
<span class="k">class</span> <span class="nc">MyClass</span>
<span class="k">end</span>
<span class="no">MyClass</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
</code></pre></div>


<p>この中には当然Moduleクラスも含まれているので、Classクラスのインスタンスメソッドmは、Moduleクラスのクラスメソッドself.mにもなります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Module</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
</code></pre></div>


<p>ところが、ModuleクラスはClassクラスのスーパークラスなので、Moduleクラスのクラスメソッドになったself.mは、Classクラスのクラスメソッドself.mにもなります。</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Class</span><span class="o">.</span><span class="n">m</span> <span class="c1"># =&gt; &quot;m&quot;</span>
</code></pre></div>


<p>整理しましょう。</p>

<p>Moduleクラスが１つのインスタンスメソッドmを持つと、それがすべてのモジュールのモジュールメソッドself.mとなり、Classクラスのインスタンスメソッドmとなり、ModuleクラスおよびClassクラスを含む、すべてのクラスのクラスメソッドself.mとなります。</p>

<p>Moduleクラスはモジュールの生成クラスです。よって、Classクラスがすべてのクラスを生み出すように、Moduleクラスはすべてのモジュールを生み出します。そして生み出されたすべてのモジュールは、Moduleクラスの特性に依存します。</p>

<p>そう、Classクラスがすべてのクラスの母であるなら...</p>

<p>「Moduleクラスはすべてのモジュールの母」なのです！</p>

<p>加えて、ModuleクラスはClassクラスのスーパークラスでもあります。そのためModuleクラスに定義されたすべてのメソッドはClassクラスで使えます。すべてのクラスはその生成クラスであるClassクラスの影響を受けるので、結果すべてのクラスはModuleクラスの影響を受けることになります。つまり、ModuleクラスはClassクラスによるクラス生成において、それを支援する極めて重要な役割を担っているのです。</p>

<p>要するにModuleクラスは、すべてのクラスの母であるClassクラスを支える...</p>

<p>「すべてのクラスの父」なのです！</p>

<p>そうModuleクラスは、一方で各モジュールの母として彼らを生み出し、他方で各クラスの父としてClassクラスを支えるという、父と母の２つの顔を持った実体だったのです！</p>

<hr />

<p><img src="/assets/images/2013/02/ruby_object_cover.png" alt="Alt title" /></p>

<p><a href="http://gum.co/zxUk" class="gumroad-button">電子書籍「オブジェクトの理解から始めるRuby」EPUB版</a><script type="text/javascript" src="https://gumroad.com/js/gumroad-button.js"></script><script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script></p>

<p>このリンクはGumroadにおける商品購入リンクになっています。クリックすると、オーバーレイ・ウインドウが立ち上がって、この場でクレジットカード決済による購入が可能です。購入にはクレジット情報およびメールアドレスの入力が必要になります。購入すると、入力したメールアドレスにコンテンツのDLリンクが送られてきます。</p>

<blockquote><p><a href="/books/" title="M'ELBORNE BOOKS">M'ELBORNE BOOKS</a></p></blockquote>

<hr />

<p>この記事は過去に書いた次の記事がベースとなっています。</p>

<blockquote><p><a href="http://melborne.github.com/2008/08/16/Ruby/" title="Rubyのクラスはオブジェクトの母、モジュールはベビーシッター">Rubyのクラスはオブジェクトの母、モジュールはベビーシッター</a></p>

<p><a href="http://melborne.github.com/2008/09/27/Ruby-Object/" title="RubyのObjectクラスは過去を再定義するタイムマシンだ！">RubyのObjectクラスは過去を再定義するタイムマシンだ！</a></p>

<p><a href="http://melborne.github.com/2008/09/30/Ruby-Module/" title="RubyのModuleクラスはすべてのモジュールの母であり同時にすべてのクラスの父である！">RubyのModuleクラスはすべてのモジュールの母であり同時にすべてのクラスの父である！</a></p></blockquote>

<hr />

<p>(追記：2013-02-08) タイトルを変更し前文を追加しました。</p>


    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* foot */
      google_ad_slot = "7511276945";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <hr>
    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2013/02/07/understand-ruby-object/" class="hatena-bookmark-button" data-hatena-bookmark-title="Rubyを始めたけど今ひとつRubyのオブジェクト指向というものが掴めないという人、ここに来て見て触って！" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2013/02/07/understand-ruby-object/" data-text="Rubyを始めたけど今ひとつRubyのオブジェクト指向というものが掴めないという人、ここに来て見て触って！" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2013/02/07/understand-ruby-object/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2013/02/07/understand-ruby-object/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2013/02/04/add-kernel-stnd-to-flippy-gem" title="flippy gemにKernel#stndを追加しましたので、お知らせします。">&larr; Previous</a></li>
      
        <li><a href="/">Archive</a></li>
        <!--<li><a href="/archive.html">Archive</a></li>-->
      
        <li class="next"><a href="/2013/02/10/tsv-to-ltsv-in-ruby" title="私、RubyでならTSVからLTSV作れます！">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'melborne'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span3">
    <div id="bookAd">
      <a href="/books/">
        <!--<img src="/assets/images/2012/start_ruby.jpg" alt="start_ruby" />-->
        <!--<img src="/assets/images/2012/jekyll_cover.jpg" alt="jekyll" />-->
        <!--<img src="/assets/images/2012/ruby_parallel_cover.png" alt="ruby_parallel" />-->
        <!--<img src="/assets/images/2012/js_oop_cover.png" alt="js_oop" />-->
        <!--<img src="/assets/images/2012/rack_cover.png" alt="rack" />-->
        <!--<img src="/assets/images/2013/02/ruby_object_cover.png" alt="ruby_object" />-->
        <img src="/assets/images/2013/03/ruby_trivia_cover.png" alt="ruby_trivia" />
      </a>
      <p id="comment">100円で好評発売中！<br/><a href="/books/">M'ELBORNE BOOKS</a></p>
    </div>

    <hr />
    

    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2013/02/07/understand-ruby-object/" class="hatena-bookmark-button" data-hatena-bookmark-title="Rubyを始めたけど今ひとつRubyのオブジェクト指向というものが掴めないという人、ここに来て見て触って！" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2013/02/07/understand-ruby-object/" data-text="Rubyを始めたけど今ひとつRubyのオブジェクト指向というものが掴めないという人、ここに来て見て触って！" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2013/02/07/understand-ruby-object/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2013/02/07/understand-ruby-object/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>

    <div class="ad" id="sideAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* sidebar */
      google_ad_slot = "0672114662";
      google_ad_width = 160;
      google_ad_height = 600;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>
  </div>
</div>


      </div>

      <footer>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-nc/2.1/jp/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/2.1/jp/88x31.png" /></a>  kyoendo 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>        </p>
      </footer>

    </div> <!-- /container -->

    

    <script type="text/javascript">
      if (location.hostname != 'localhost') {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-288751-18']);
        _gaq.push(['_trackPageview']);
  
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      };
    </script>

    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <script src="/assets/javascripts/jquery-1.7.2.min.js"></script>
    <script src="/assets/javascripts/lightbox.js"></script>

    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>
  </body>
</html>

